
<!doctype html>














<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="" />








  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=5.1.1" />
















<meta name="description" content="代码的仓库">
<meta name="keywords" content="Jekyll, NexT">
<meta property="og:type" content="article">
<meta property="og:title" content="ReactiveCocoa">
<meta property="og:url" content="http://localhost:4000/ios/2020/05/28/ios-reactivecocoa/">
<meta property="og:site_name" content="Sam's Blog">
<meta property="og:description" content="代码的仓库">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="/assets/images/iOS/rac/02.gif">
<meta property="og:image" content="/assets/images/iOS/rac/03.gif">
<meta property="og:image" content="/assets/images/iOS/rac/07.png">
<meta property="og:image" content="/assets/images/iOS/rac/08.png">
<meta property="og:image" content="/assets/images/iOS/rac/09.png">
<meta property="og:image" content="/assets/images/iOS/rac/10.png">
<meta property="og:image" content="/assets/images/iOS/rac/06.gif">
<meta property="og:image" content="/assets/images/iOS/rac/05.png">
<meta property="og:image" content="/assets/images/iOS/rac/04.png">
<meta property="og:image" content="/assets/images/iOS/rac/01.gif">
<meta property="og:image" content="/assets/images/iOS/rac/15.gif">
<meta property="og:image" content="/assets/images/iOS/rac/16.gif">
<meta property="og:image" content="/assets/images/iOS/rac/17.gif">
<meta property="og:image" content="/assets/images/iOS/rac/18.gif">
<meta property="og:image" content="/assets/images/iOS/rac/19.gif">
<meta property="og:image" content="/assets/images/iOS/rac/20.gif">
<meta property="og:image" content="/assets/images/iOS/rac/14.gif">
<meta property="og:image" content="/assets/images/iOS/rac/13.gif">
<meta property="og:image" content="/assets/images/iOS/rac/11.gif">
<meta property="og:image" content="/assets/images/iOS/rac/12.gif">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ReactiveCocoa">
<meta name="twitter:description" content="代码的仓库">
<meta name="twitter:image" content="/assets/images/iOS/rac/02.gif">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://localhost:4000/"/>





  <title>ReactiveCocoa | Sam's Blog</title>
  
















</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sam's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/ios/2020/05/28/ios-reactivecocoa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sam Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sam's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
          
          
            ReactiveCocoa
          
        </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-28T00:00:00+08:00">
                2020-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/ios" itemprop="url" rel="index">
                    <span itemprop="name">ios</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
            
                <div class="post-description">
                    
                </div>
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
  
  












  <p><a href="https://gitee.com/samcoding/RACExample.git">代码的仓库</a></p>

<h2 id="基础">基础</h2>

<h3 id="racsignal-触发流程">RACSignal 触发流程</h3>

<p>下面代码是<code class="language-plaintext highlighter-rouge">RACSignal</code>创建和被订阅的演示。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_sig_1</span><span class="p">{</span>
    <span class="c1">//Create a Signal.</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">NSInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">i</span><span class="p">)];</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">RACDisposable</span> <span class="nf">disposableWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACDisposable block"</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="c1">// Subscribe a Signal</span>
    <span class="c1">// English: disposable: adj.可任意处理的；可自由使用的；用完即可丢弃的</span>
    <span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">disposable</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Recive signal:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span> <span class="nf">error</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Recive signal:%@"</span><span class="p">,</span><span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">completed</span><span class="o">:^</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"completed!"</span><span class="p">);</span>
    <span class="p">}]</span> <span class="p">;</span>
    
    <span class="c1">// Release the Subscriber</span>
    <span class="p">[</span><span class="n">disposable</span> <span class="nf">dispose</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">RACSignal</code>底层实现:</p>

<ul>
  <li>创建信号，首先把<code class="language-plaintext highlighter-rouge">didSubscribe</code>保存到信号中，还不会触发。</li>
  <li>当信号被订阅(调用signal的<code class="language-plaintext highlighter-rouge">subscribeNext:nextBlock</code>)时：
    <ul>
      <li><code class="language-plaintext highlighter-rouge">subscribeNext</code>内部会创建订阅者<code class="language-plaintext highlighter-rouge">subscriber</code>，并且把<code class="language-plaintext highlighter-rouge">nextBlock</code>保存到<code class="language-plaintext highlighter-rouge">subscriber</code>中</li>
      <li><code class="language-plaintext highlighter-rouge">subscribeNext</code>内部会调用siganl的<code class="language-plaintext highlighter-rouge">didSubscribe</code></li>
      <li>当信号订阅完成, 不在发送数据的时候, 最好调用完成发送的<code class="language-plaintext highlighter-rouge">[subscriber sendCompleted]</code></li>
      <li>订阅完成的时候, 内部会自动调用<code class="language-plaintext highlighter-rouge">[RACDisposable disposable]</code>取消订阅信号</li>
    </ul>
  </li>
  <li>当siganl的<code class="language-plaintext highlighter-rouge">didSubscribe</code>中调用<code class="language-plaintext highlighter-rouge">[subscriber sendNext:@1]</code>时，<code class="language-plaintext highlighter-rouge">sendNext</code>底层其实就是执行<code class="language-plaintext highlighter-rouge">subscriber</code>的<code class="language-plaintext highlighter-rouge">nextBlock</code></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">RACSignal</code>的一些子类及作用：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25</pre></td><td class="code"><pre class="highlight"><code><span class="c1">//  `RACDynamicSignal`(动态信号) 是`RACSignal`的子类,使用一个`block`来实现订阅行为。</span>
<span class="k">@interface</span> <span class="nc">RACDynamicSignal</span> <span class="p">:</span> <span class="nc">RACSignal</span>
<span class="c1">// block 中 id&lt;RACSubscriber&gt; subscriber</span>
<span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">createSignal</span><span class="p">:(</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">))</span><span class="nv">didSubscribe</span><span class="p">;</span>
<span class="k">@end</span>
<span class="c1">// 一元信号，用来实现 RACSignal 的 +return:方法</span>
<span class="k">@interface</span> <span class="nc">RACReturnSignal</span><span class="o">&lt;</span><span class="n">__covariant</span> <span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span>
<span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nf">return</span><span class="p">:(</span><span class="n">ValueType</span><span class="p">)</span><span class="nv">value</span><span class="p">;</span>
<span class="k">@end</span>
<span class="c1">// 错误信号，用来实现 RACSignal 的 +error: 方法</span>
<span class="k">@interface</span> <span class="nc">RACErrorSignal</span> <span class="p">:</span> <span class="nc">RACSignal</span>
<span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">@end</span>

<span class="c1">// 通道终端，代表 RACChannel 的一个终端，用来实现双向绑定</span>
<span class="k">@interface</span> <span class="nc">RACChannelTerminal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">unavailable</span><span class="p">(</span><span class="s">"Instantiate a RACChannel instead"</span><span class="p">)));</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendNext</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ValueType</span><span class="p">)</span><span class="nv">value</span><span class="p">;</span>
<span class="k">@end</span>

<span class="c1">// 信号提供者，自己可以充当信号，又能发送信号</span>
<span class="k">@interface</span> <span class="nc">RACSubject</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>
<span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">subject</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendNext</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ValueType</span><span class="p">)</span><span class="nv">value</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">RACSubscriber</code> 订阅者协议的内容：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6</pre></td><td class="code"><pre class="highlight"><code><span class="k">@protocol</span> <span class="nc">RACSubscriber</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendNext</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">value</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendError</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">sendCompleted</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">didSubscribeWithDisposable</span><span class="p">:(</span><span class="n">RACCompoundDisposable</span> <span class="o">*</span><span class="p">)</span><span class="nv">disposable</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="racsubjectracreplaysubject">RACSubject、RACReplaySubject</h3>

<p><code class="language-plaintext highlighter-rouge">RACSubject</code> 信号提供者：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">RACSubject(信号提供者)</code>，自己可以充当信号，又能发送信号。</li>
  <li>触发条件：先订阅, 再发送信号。</li>
  <li>使用场景:通常用来代替代理/通知。</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">RACReplaySubject</code> 重复提供信号：</p>

<ul>
  <li>先发送信号，再订阅信号</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">TestViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">RACReplaySubject</span> <span class="o">*</span><span class="n">replaySubject</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">subject</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">TestViewModel</span>
<span class="k">-</span><span class="p">(</span><span class="n">RACReplaySubject</span> <span class="o">*</span><span class="p">)</span><span class="n">replaySubject</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_replaySubject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_replaySubject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_replaySubject</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">RACSubject</span> <span class="o">*</span><span class="p">)</span><span class="n">subject</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_subject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_subject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_subject</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">TestViewController</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">registerButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">loginButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span><span class="n">textLabel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">textField</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">sendSingnalButton</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">TestViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">TestViewController</span>


<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">loginButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"you clicked the login button!"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">replaySubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACReplaySubject %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACSubject %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">registerButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"you clicked the register button!"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">replaySubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACReplaySubject %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACSubject %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">sendSingnalButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">subject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@2</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">replaySubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@2</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="n">TestViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[</span><span class="n">TestViewModel</span> <span class="nf">new</span><span class="p">];</span>
        <span class="p">[</span><span class="n">_viewModel</span><span class="p">.</span><span class="n">replaySubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
        <span class="p">[</span><span class="n">_viewModel</span><span class="p">.</span><span class="n">subject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="cm">/*
you clicked the login button!
RACReplaySubject 1 ==&gt; RACReplaySubject 先发送了信号，然后再点击login方法进行订阅。这里没有 RACSubject 的打印信息，是因为 RACSubject 必须先订阅再发送信号。

you clicked the register button!
RACReplaySubject 1 ==&gt; RACReplaySubject 先发送了信号，然后再点击login方法进行订阅。这里没有 RACSubject 的打印信息，是因为 RACSubject 必须先订阅再发送信号。

RACSubject 2
RACSubject 2 ==&gt; login register 两个方法各订阅了一次信号，点击几次方法就会重复订阅
RACReplaySubject 2 ==&gt; login register 两个方法各订阅了一次信号，点击几次方法就会重复订阅
RACReplaySubject 2

RACSubject 2
RACSubject 2
RACReplaySubject 2
RACReplaySubject 2
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/02.gif" /></p>

<p>做一个<code class="language-plaintext highlighter-rouge">RACSubject</code>作为代理的简单示例：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">TestViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">subject</span><span class="p">;</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">loadData</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">TestViewModel</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">loadData</span><span class="p">{</span>
    <span class="c1">// request service data,return data to vc</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">subject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">RACSubject</span> <span class="o">*</span><span class="p">)</span><span class="n">subject</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_subject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_subject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_subject</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">TestViewController</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">registerButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">loginButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span><span class="n">textLabel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">textField</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">sendSingnalButton</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">TestViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">TestViewController</span>


<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Service data: %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">loginButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"you clicked the login button!"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span> <span class="nf">loadData</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="n">TestViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[</span><span class="n">TestViewModel</span> <span class="nf">new</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/03.gif" /></p>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="冷信号与热信号">冷信号与热信号</h2>

<h3 id="热信号">热信号</h3>

<ul>
  <li><strong>热信号是主动的，即使你没有订阅事件，它仍然会时刻推送。</strong> 例中：信号在 19:37:55 被创建，在 19:37:56 发出信号1，但是没有订阅，在 19:37:57发出信号2，这是有一个订阅。</li>
  <li><strong>热信号可以有多个订阅者，是一对多，信号可以与订阅者共享信息。</strong> 例中：订阅者1和订阅者2都在 19:37:58 收到了数据。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    
    <span class="n">RACMulticastConnection</span> <span class="o">*</span> <span class="n">connection</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">2</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@2</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">3</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@3</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">4</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}]</span><span class="nf">publish</span><span class="p">];</span>
    <span class="p">[</span><span class="n">connection</span> <span class="nf">connect</span><span class="p">];</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">signal</span><span class="p">;</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Signal was created."</span><span class="p">);</span>
    
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 1 recveive: %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">2</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 2 recveive: %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2020-05-28 19:37:55.689906+0800 RACExample[56065:11840136] Signal was created. 
2020-05-28 19:37:57.690140+0800 RACExample[56065:11840136] Subscriber 1 recveive: 2
2020-05-28 19:37:58.690022+0800 RACExample[56065:11840136] Subscriber 1 recveive: 3
2020-05-28 19:37:58.690210+0800 RACExample[56065:11840136] Subscriber 2 recveive: 3
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="冷信号">冷信号</h3>

<ul>
  <li><strong>冷信号是被动的，只有当你订阅的时候，它才会发送消息。</strong></li>
  <li><strong>冷信号只能一对一，当有不同的订阅者，消息会从新完整发送。</strong> 例中：两个订阅者没有联系，都是基于各自的订阅时间开始接收消息的。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">2</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@2</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">3</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@3</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">4</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Signal was created."</span><span class="p">);</span>
    
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 1 recveive: %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">2</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 2 recveive: %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2020-05-28 19:42:38.439542+0800 RACExample[56245:11843585] Signal was created.
2020-05-28 19:42:40.540420+0800 RACExample[56245:11843585] Subscriber 1 recveive: 1
2020-05-28 19:42:41.537044+0800 RACExample[56245:11843585] Subscriber 1 recveive: 2
2020-05-28 19:42:41.849789+0800 RACExample[56245:11843585] Subscriber 2 recveive: 1
2020-05-28 19:42:42.669102+0800 RACExample[56245:11843585] Subscriber 1 recveive: 3
2020-05-28 19:42:42.884800+0800 RACExample[56245:11843585] Subscriber 2 recveive: 2
2020-05-28 19:42:43.841321+0800 RACExample[56245:11843585] Subscriber 2 recveive: 3
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="冷信号热信号比较">冷信号、热信号比较</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86<br/>87<br/>88<br/>89<br/>90<br/>91<br/>92<br/>93<br/>94<br/>95<br/>96<br/>97<br/>98<br/>99<br/>100<br/>101<br/>102<br/>103<br/>104<br/>105<br/>106<br/>107<br/>108<br/>109<br/>110<br/>111<br/>112<br/>113<br/>114<br/>115<br/>116<br/>117<br/>118<br/>119<br/>120<br/>121<br/>122<br/>123<br/>124<br/>125<br/>126<br/>127<br/>128</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// 冷信号代码</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_Signal</span><span class="p">{</span>
    <span class="c1">// Create an RACReplaySubject signals</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Send Signals</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"replaySubject send package 1"</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="c1">// Send Signals</span>
        <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">2</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"replaySubject send package 2"</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">RACDisposable</span> <span class="nf">disposableWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"disposable"</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"create Signal"</span><span class="p">);</span>
    
    <span class="c1">// Subscribe the signal</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">//Subscriber1</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 1 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        
        <span class="c1">//Subscriber2</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 2 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    
    <span class="c1">// Subscribe the signal</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">//Subscriber3</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 3 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        
        <span class="c1">//Subscriber4</span>
        <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 4 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="c1">// Subject 热信号代码</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_RACSubject</span><span class="p">{</span>
    <span class="c1">// Create a RACSubject signal</span>
    <span class="n">RACSubject</span> <span class="o">*</span><span class="n">subject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"create Signal"</span><span class="p">);</span>
    
    <span class="c1">// Subscribe the signal</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">//Subscriber1</span>
        <span class="p">[</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 1 get a next value: %@ from subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        <span class="c1">//Subscriber2</span>
        <span class="p">[</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 2 get a next value: %@ from subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    
    <span class="c1">// Send Signals</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">subject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"subject send package 1"</span><span class="p">];</span>
    <span class="p">}];</span>
    
    <span class="c1">// Subscribe the signal</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">//Subscriber3</span>
        <span class="p">[</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 3 get a next value: %@ from subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        
        <span class="c1">//Subscriber4</span>
        <span class="p">[</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 4 get a next value: %@ from subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
       
    <span class="p">}];</span>
    
    <span class="c1">// Send Signals</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">2</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">subject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"subject send package 2"</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="c1">// ReplaySubject 热信号代码</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_RACReplaySubject</span><span class="p">{</span>
    <span class="c1">// Create an RACReplaySubject signals</span>
    <span class="n">RACSubject</span> <span class="o">*</span><span class="n">replaySubject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"create Signal"</span><span class="p">);</span>
    
    <span class="c1">// Subscribe the signal</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">//Subscriber1</span>
        <span class="p">[</span><span class="n">replaySubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 1 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        
        <span class="c1">//Subscriber2</span>
        <span class="p">[</span><span class="n">replaySubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 2 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    
    <span class="c1">// Send Signals</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">replaySubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"replaySubject send package 1"</span><span class="p">];</span>
    <span class="p">}];</span>
    
    <span class="c1">// Subscribe the signal</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="c1">//Subscriber3</span>
        <span class="p">[</span><span class="n">replaySubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 3 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
        
        <span class="c1">//Subscriber4</span>
        <span class="p">[</span><span class="n">replaySubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Subscriber 4 get a next value: %@ from replay subject"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    
    <span class="c1">// Send Signals</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">2</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">replaySubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"replaySubject send package 2"</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">RACSignal</code>和热信号<code class="language-plaintext highlighter-rouge">RACSubject</code>时间比较：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">RACSubject</code>中，4个订阅者共享<code class="language-plaintext highlighter-rouge">subject</code>,在<code class="language-plaintext highlighter-rouge">subject</code>发送信号的时候，所有的订阅者都能收到信号数据；因为<code class="language-plaintext highlighter-rouge">subscriber3</code>、<code class="language-plaintext highlighter-rouge">subscriber4</code>订阅的时间稍后，错过了<code class="language-plaintext highlighter-rouge">subject</code>发送的信号数据。</li>
  <li>对比发现: <code class="language-plaintext highlighter-rouge">subject</code>类似<mark>直播，错过了就不再处理</mark>。而<code class="language-plaintext highlighter-rouge">signal</code>类似<mark>点播，每次订阅都会从头开始</mark>。所以我们有理由认定<code class="language-plaintext highlighter-rouge">subject</code>天然就是热信号。</li>
</ul>

<p><img src="/assets/images/iOS/rac/07.png" /></p>

<p>冷信号<code class="language-plaintext highlighter-rouge">RACSignal</code>和热信号<code class="language-plaintext highlighter-rouge">ReplayRACSubject</code>时间比较：</p>

<p><img src="/assets/images/iOS/rac/08.png" /></p>

<p>热信号<code class="language-plaintext highlighter-rouge">RACSubject</code>和热信号<code class="language-plaintext highlighter-rouge">ReplayRACSubject</code>时间比较：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ReplayRACSubject</code>中，<code class="language-plaintext highlighter-rouge">Subscriber 3</code>与<code class="language-plaintext highlighter-rouge">Subscriber 4</code>在订阅后马上接收到了“历史值”。对于<code class="language-plaintext highlighter-rouge">Subscriber 3</code>和<code class="language-plaintext highlighter-rouge">Subscriber 4</code>来说，它们只关心“历史的值”而不关心“历史的时间线”。·</li>
</ul>

<p><img src="/assets/images/iOS/rac/09.png" /></p>

<p>热信号和冷信号类：</p>

<p><img src="/assets/images/iOS/rac/10.png" /></p>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="基础使用">基础使用</h2>

<h3 id="racmulticastconnection">RACMulticastConnection</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"发送信号1"</span><span class="p">);</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"1"</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}];</span>
<span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">NSLog</span><span class="p">(</span><span class="s">@"第一次订阅：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);}];</span>
<span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">NSLog</span><span class="p">(</span><span class="s">@"第二次订阅：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);}];</span>
<span class="cm">/*
2020-06-08 16:20:16.479977+0800 RACExample[46980:352112] 发送信号1
2020-06-08 16:20:16.480517+0800 RACExample[46980:352112] 第一次订阅：1
2020-06-08 16:20:16.480976+0800 RACExample[46980:352112] 发送信号1
2020-06-08 16:20:16.481336+0800 RACExample[46980:352112] 第二次订阅：1
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>在信号<code class="language-plaintext highlighter-rouge">signal</code>被订阅2次以后，<code class="language-plaintext highlighter-rouge">createSignal:</code>block也被触发了2次。通过<code class="language-plaintext highlighter-rouge">RACMulticastConnection</code>可以解决信号被n次订阅后，block也会被触发n次的情况。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"发送信号1"</span><span class="p">);</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"1"</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}];</span>
<span class="n">RACMulticastConnection</span> <span class="o">*</span><span class="n">signalBconnect</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span> <span class="nf">publish</span><span class="p">];</span>
<span class="p">[</span><span class="n">signalBconnect</span><span class="p">.</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">NSLog</span><span class="p">(</span><span class="s">@"第一次订阅：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);}];</span>
<span class="p">[</span><span class="n">signalBconnect</span><span class="p">.</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">NSLog</span><span class="p">(</span><span class="s">@"第二次订阅：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);}];</span>
<span class="p">[</span><span class="n">signalBconnect</span> <span class="nf">connect</span><span class="p">];</span>
<span class="cm">/*
2020-06-08 16:25:18.009553+0800 RACExample[47186:354797] 发送信号1
2020-06-08 16:25:18.009805+0800 RACExample[47186:354797] 第一次订阅：1
2020-06-08 16:25:18.009907+0800 RACExample[47186:354797] 第二次订阅：1
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>也可以通过<code class="language-plaintext highlighter-rouge">RACSignal</code>热信号去解决，其实<code class="language-plaintext highlighter-rouge">RACMulticastConnection</code>就相当于把<code class="language-plaintext highlighter-rouge">signal</code>变成了热信号：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACSubject</span> <span class="o">*</span><span class="n">subject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
<span class="p">[</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">NSLog</span><span class="p">(</span><span class="s">@"第一次订阅：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);}];</span>
<span class="p">[</span><span class="n">subject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">NSLog</span><span class="p">(</span><span class="s">@"第二次订阅：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);}];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"发送信号1"</span><span class="p">);</span>
<span class="p">[</span><span class="n">subject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"1"</span><span class="p">];</span>
<span class="cm">/*
2020-06-08 16:26:34.201680+0800 RACExample[47240:355739] 发送信号1
2020-06-08 16:26:34.202059+0800 RACExample[47240:355739] 第一次订阅：1
2020-06-08 16:26:34.202349+0800 RACExample[47240:355739] 第二次订阅：1
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="线程操作">线程操作</h3>

<ul>
  <li>副作用：关于信号与线程,我们把在创建信号时block中的代码称之为副作用。</li>
  <li><code class="language-plaintext highlighter-rouge">deliverON</code>：切换到指定线程中，可用于回到主线中刷新UI,内容传递切换到指定线程中，</li>
  <li><code class="language-plaintext highlighter-rouge">subscribeOn</code>：内容传递和副作用都会切换到指定线程中。</li>
  <li><code class="language-plaintext highlighter-rouge">deliverOnMainThread</code>：能保证原信号<code class="language-plaintext highlighter-rouge">subscribeNext</code>，<code class="language-plaintext highlighter-rouge">sendError</code>，<code class="language-plaintext highlighter-rouge">sendCompleted</code>都在主线程<code class="language-plaintext highlighter-rouge">MainThread</code>中执行。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32</pre></td><td class="code"><pre class="highlight"><code><span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">^</span><span class="p">{</span>
    <span class="p">[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendNext1:%@"</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span><span class="c1">// sendNext1:&lt;NSThread: 0x600001f36300&gt;{number = 4, name = (null)}</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"1"</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext%@:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span><span class="c1">//subscribeNext1:&lt;NSThread: 0x600001f36300&gt;{number = 4, name = (null)}</span>
    <span class="p">}];</span>
<span class="p">});</span>
<span class="c1">// 发送消息、接收消息都是在异步线程。</span>

<span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">^</span><span class="p">{</span>
    <span class="p">[[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendNext1:%@"</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span><span class="c1">// sendNext1:&lt;NSThread: 0x600003e40040&gt;{number = 4, name = (null)}</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"1"</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}]</span> <span class="nf">deliverOn</span><span class="p">:[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext%@:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span><span class="c1">//subscribeNext1:&lt;NSThread: 0x600003e04980&gt;{number = 1, name = main}</span>
    <span class="p">}];</span>
<span class="p">});</span>
<span class="c1">// 接收消息在主线程。</span>

<span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">^</span><span class="p">{</span>
    <span class="p">[[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendNext1:%@"</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span><span class="c1">// sendNext1:&lt;NSThread: 0x6000035fcbc0&gt;{number = 1, name = main}</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"1"</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}]</span> <span class="nf">subscribeOn</span><span class="p">:[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext%@:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span><span class="c1">//subscribeNext1:&lt;NSThread: 0x6000035fcbc0&gt;{number = 1, name = main}</span>
    <span class="p">}];</span>
<span class="p">});</span>
<span class="c1">// 发送消息、接收消息都是在主线程。</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号节流throttle">信号节流:throttle</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">throttle节流</code>:当某个信号发送比较频繁时，可以使用节流，在某一段时间不发送信号内容，过了一段时间获取信号的最新内容发出。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"11"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息11"</span><span class="p">];</span>
    <span class="n">dispatch_after</span><span class="p">(</span><span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">)),</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"21"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息21"</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"22"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息22"</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="n">dispatch_after</span><span class="p">(</span><span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">)),</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"31"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息31"</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"32"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息32"</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"33"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息33"</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="n">dispatch_after</span><span class="p">(</span><span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">)),</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"41"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息41"</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"42"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息42"</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"43"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息43"</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"44"</span><span class="p">);[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送消息44"</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}]</span> <span class="nf">throttle</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Next:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>

<span class="cm">/*
2020-06-08 19:09:37.356497+0800 RACExample[54681:455884] 11
2020-06-08 19:09:39.357101+0800 RACExample[54681:455884] Next:发送消息11
2020-06-08 19:09:39.357366+0800 RACExample[54681:455884] 21
2020-06-08 19:09:39.357518+0800 RACExample[54681:455884] 22
2020-06-08 19:09:40.540307+0800 RACExample[54681:455884] 31
2020-06-08 19:09:40.541107+0800 RACExample[54681:455884] 32
2020-06-08 19:09:40.541341+0800 RACExample[54681:455884] 33
2020-06-08 19:09:41.357386+0800 RACExample[54681:455884] 41
2020-06-08 19:09:41.357600+0800 RACExample[54681:455884] 42
2020-06-08 19:09:41.357734+0800 RACExample[54681:455884] 43
2020-06-08 19:09:41.357856+0800 RACExample[54681:455884] 44
2020-06-08 19:09:43.369260+0800 RACExample[54681:455884] Next:发送消息44
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号错误重试retry">信号错误重试:retry</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">retry重试</code> ：只要失败，就会重新执行创建信号中的block,直到成功.</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28</pre></td><td class="code"><pre class="highlight"><code><span class="k">static</span> <span class="kt">int</span> <span class="n">signalANum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">signalANum</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendNext %d"</span><span class="p">,</span><span class="n">signalANum</span><span class="p">);</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"尝试次数累计：%d"</span><span class="p">,</span><span class="n">signalANum</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendError %d"</span><span class="p">,</span><span class="n">signalANum</span><span class="p">);</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendError</span><span class="p">:[</span><span class="n">NSError</span> <span class="nf">errorWithDomain</span><span class="p">:</span><span class="s">@""</span> <span class="nf">code</span><span class="p">:</span><span class="mi">0</span> <span class="nf">userInfo</span><span class="p">:@{</span><span class="n">NSLocalizedDescriptionKey</span><span class="o">:</span><span class="s">@"Something is wrong!"</span><span class="p">}]];</span>
    <span class="p">}</span>
    <span class="n">signalANum</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}];</span>

<span class="p">[[</span><span class="n">signal</span> <span class="nf">retry</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span> <span class="nf">error</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"error info: %@"</span><span class="p">,</span><span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
<span class="p">}];</span>
<span class="cm">/*
2020-06-08 19:03:16.750255+0800 RACExample[54389:451981] sendError 0
2020-06-08 19:03:16.774608+0800 RACExample[54389:451981] sendError 1
2020-06-08 19:03:16.774899+0800 RACExample[54389:451981] sendError 2
2020-06-08 19:03:16.775074+0800 RACExample[54389:451981] sendError 3
2020-06-08 19:03:16.775254+0800 RACExample[54389:451981] sendError 4
2020-06-08 19:03:16.775446+0800 RACExample[54389:451981] sendNext 5
2020-06-08 19:03:16.775579+0800 RACExample[54389:451981] subscribeNext：尝试次数累计：5
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="获取信号中的信号-switchtolatest">获取信号中的信号: switchToLatest</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">switchToLatest</code>只能用于信号中的信号(否则崩溃)，获取最新发送的信号。</li>
  <li><code class="language-plaintext highlighter-rouge">switchToLatest</code>:用于<code class="language-plaintext highlighter-rouge">signalOfSignals（信号的信号）</code>，有时候信号也会发出信号，会在<code class="language-plaintext highlighter-rouge">signalOfSignals</code>中，获取<code class="language-plaintext highlighter-rouge">signalOfSignals</code>发送的最新信号。</li>
</ul>

<h3 id="信号发送顺序donextdocompleted">信号发送顺序:doNext、doCompleted</h3>

<ul>
  <li>发送信号前与发送信号后操作：<code class="language-plaintext highlighter-rouge">doNext</code>、<code class="language-plaintext highlighter-rouge">doCompleted</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">doNext</code>：在订阅者发送消息sendNext之前执行。</li>
  <li><code class="language-plaintext highlighter-rouge">doCompleted</code>：在订阅者发送完成sendCompleted之后执行。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"发送信号：1"</span><span class="p">);</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"发送信号：1"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}];</span>
<span class="p">[[[</span><span class="n">signal</span> <span class="nf">doNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"doNext,%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}]</span> <span class="nf">doCompleted</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"doCompleted"</span><span class="p">);</span>
<span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"激活信号：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
<span class="cm">/*
2020-06-08 18:49:53.413848+0800 RACExample[53730:443023] 发送信号：1
2020-06-08 18:49:53.414098+0800 RACExample[53730:443023] doNext,发送信号：1
2020-06-08 18:49:53.414220+0800 RACExample[53730:443023] 激活信号：发送信号：1
2020-06-08 18:49:53.414823+0800 RACExample[53730:443023] doCompleted
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号取值taketakeuntiltakelast">信号取值:take、takeUntil、takeLast</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">take</code>:从开始一共取N次的信号</li>
  <li><code class="language-plaintext highlighter-rouge">takeLast</code>:取最后N次的信号,前提条件，订阅者必须调用完成，因为只有完成，就知道总共有多少信号.</li>
  <li><code class="language-plaintext highlighter-rouge">takeUntil</code>:(RACSignal):获取信号直到某个信号执行完成(原始信号一直发送信号，直到，替代的信号发出事件，原始信号终止)。</li>
  <li><code class="language-plaintext highlighter-rouge">skip</code>:(NSUInteger):跳过几个信号,不接受。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="n">RACSignal</span><span class="o">*</span><span class="p">)</span><span class="n">createSignal</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscriber sendNext -- %d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">i</span><span class="p">)];</span>
        <span class="p">}</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendCompleted"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_take</span><span class="p">{</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">createSignal</span><span class="p">];</span>
   <span class="p">[</span><span class="n">signal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext -- %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
   <span class="p">}];</span>
    <span class="cm">/*
     2020-06-03 14:51:53.558366+0800 RACExample[30888:2260368] subscriber sendNext -- 0
     2020-06-03 14:51:53.558606+0800 RACExample[30888:2260368] subscribeNext -- 0
     2020-06-03 14:51:53.558714+0800 RACExample[30888:2260368] subscriber sendNext -- 1
     2020-06-03 14:51:53.558807+0800 RACExample[30888:2260368] subscribeNext -- 1
     2020-06-03 14:51:53.558898+0800 RACExample[30888:2260368] subscriber sendNext -- 2
     2020-06-03 14:51:53.558985+0800 RACExample[30888:2260368] subscribeNext -- 2
     2020-06-03 14:51:53.559069+0800 RACExample[30888:2260368] subscriber sendNext -- 3
     2020-06-03 14:51:53.559159+0800 RACExample[30888:2260368] subscribeNext -- 3
     2020-06-03 14:51:53.559249+0800 RACExample[30888:2260368] subscriber sendNext -- 4
     2020-06-03 14:51:53.559439+0800 RACExample[30888:2260368] subscribeNext -- 4
     2020-06-03 14:51:53.559708+0800 RACExample[30888:2260368] sendCompleted
     */</span>
</code></pre></td></tr></tbody></table></div></div>

<p>上面是正常的订阅。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_take</span><span class="p">{</span>
    <span class="p">[[</span><span class="n">signal</span> <span class="nf">take</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext -- %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="cm">/*
     2020-06-03 14:53:40.530949+0800 RACExample[30990:2262219] subscriber sendNext -- 0
     2020-06-03 14:53:40.531286+0800 RACExample[30990:2262219] subscribeNext -- 0
     2020-06-03 14:53:40.531476+0800 RACExample[30990:2262219] subscriber sendNext -- 1
     2020-06-03 14:53:40.531610+0800 RACExample[30990:2262219] subscribeNext -- 1
     2020-06-03 14:53:40.531734+0800 RACExample[30990:2262219] subscriber sendNext -- 2
     2020-06-03 14:53:40.531829+0800 RACExample[30990:2262219] subscriber sendNext -- 3
     2020-06-03 14:53:40.531924+0800 RACExample[30990:2262219] subscriber sendNext -- 4
     2020-06-03 14:53:40.532056+0800 RACExample[30990:2262219] sendCompleted
     */</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">take:2</code> : 只取前两次订阅的信号。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_take</span><span class="p">{</span>
    <span class="p">[[[</span><span class="n">signal</span> <span class="nf">skip</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">take</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext -- %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="cm">/*
     2020-06-03 14:59:58.615703+0800 RACExample[31246:2265921] subscriber sendNext -- 0 ==&gt; 虽然发送的数据，但是 subscriber 没有使用，跳过这一条
     2020-06-03 14:59:58.616069+0800 RACExample[31246:2265921] subscriber sendNext -- 1
     2020-06-03 14:59:58.616254+0800 RACExample[31246:2265921] subscribeNext -- 1       ==&gt; take:1
     2020-06-03 14:59:58.616376+0800 RACExample[31246:2265921] subscriber sendNext -- 2
     2020-06-03 14:59:58.616494+0800 RACExample[31246:2265921] subscriber sendNext -- 3
     2020-06-03 14:59:58.616608+0800 RACExample[31246:2265921] subscriber sendNext -- 4
     */</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>
<p><code class="language-plaintext highlighter-rouge">skip:1</code>和<code class="language-plaintext highlighter-rouge">take:1</code> : 跳过第一条开始接收数据，并且只取前一条数据。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_takeLast</span><span class="p">{</span>
    <span class="p">[[</span><span class="n">signal</span> <span class="nf">takeLast</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext -- %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="cm">/*
     2020-06-03 15:04:32.363153+0800 RACExample[31419:2268388] signal -- 0
     2020-06-03 15:04:32.363415+0800 RACExample[31419:2268388] signal -- 1
     2020-06-03 15:04:32.363534+0800 RACExample[31419:2268388] signal -- 2
     2020-06-03 15:04:32.363639+0800 RACExample[31419:2268388] signal -- 3
     2020-06-03 15:04:32.363741+0800 RACExample[31419:2268388] signal -- 4
     2020-06-03 15:04:32.363943+0800 RACExample[31419:2268388] subscribeNext -- 3
     2020-06-03 15:04:32.364053+0800 RACExample[31419:2268388] subscribeNext -- 4
     */</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">takeLast:1</code> : 只获取最新的数据。</p>

<h3 id="mapflattenmap拦截信号处理数据">map、flattenMap(拦截信号处理数据)</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">map</code> ：将信号内容修改为另一种新值。改变了传递的值。</li>
  <li><code class="language-plaintext highlighter-rouge">flattenMap</code>：将源信号映射修改为另一种新的信号(<code class="language-plaintext highlighter-rouge">RACSignal</code>),修改了信号本身。</li>
</ul>

<h4 id="示例">示例</h4>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_map</span><span class="p">{</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">syncSignal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"signal -- %d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">i</span><span class="p">)];</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
    
    <span class="p">[[</span><span class="n">syncSignal</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"map -- %@"</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"MAP+%@"</span><span class="p">,</span><span class="n">value</span><span class="p">];</span>
    <span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext -- %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2019-08-30 14:00:05.098586+0800 RACExample[99686:2868124] signal -- 0
2019-08-30 14:00:05.098791+0800 RACExample[99686:2868124] map -- 0
2019-08-30 14:00:05.098987+0800 RACExample[99686:2868124] subscribeNext -- MAP+0
2019-08-30 14:00:05.099149+0800 RACExample[99686:2868124] signal -- 1
2019-08-30 14:00:05.099244+0800 RACExample[99686:2868124] map -- 1
2019-08-30 14:00:05.099370+0800 RACExample[99686:2868124] subscribeNext -- MAP+1
2019-08-30 14:00:05.099522+0800 RACExample[99686:2868124] signal -- 2
2019-08-30 14:00:05.099601+0800 RACExample[99686:2868124] map -- 2
2019-08-30 14:00:05.099717+0800 RACExample[99686:2868124] subscribeNext -- MAP+2
2019-08-30 14:00:05.099866+0800 RACExample[99686:2868124] signal -- 3
2019-08-30 14:00:05.100081+0800 RACExample[99686:2868124] map -- 3
2019-08-30 14:00:05.100398+0800 RACExample[99686:2868124] subscribeNext -- MAP+3
2019-08-30 14:00:05.100599+0800 RACExample[99686:2868124] signal -- 4
2019-08-30 14:00:05.100759+0800 RACExample[99686:2868124] map -- 4
2019-08-30 14:00:05.100999+0800 RACExample[99686:2868124] subscribeNext -- MAP+4
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>flattenMap</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">syncSignal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"signal -- %d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">i</span><span class="p">)];</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>

    <span class="p">[[</span><span class="n">syncSignal</span> <span class="nf">flattenMap</span><span class="p">:</span><span class="o">^</span><span class="n">__kindof</span> <span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"map -- %@"</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">return</span><span class="p">:</span><span class="n">value</span><span class="p">].</span><span class="n">logCompleted</span><span class="p">;</span>
    <span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext -- %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2020-05-28 14:44:12.520009+0800 RACExample[45556:11658886] signal -- 0
2020-05-28 14:44:12.520142+0800 RACExample[45556:11658886] map -- 0
2020-05-28 14:44:12.520316+0800 RACExample[45556:11658886] subscribeNext -- 0
2020-05-28 14:44:12.520456+0800 RACExample[45556:11658886] &lt;RACReturnSignal: 0x60000023e320&gt; name:  completed
2020-05-28 14:44:12.520567+0800 RACExample[45556:11658886] signal -- 1
2020-05-28 14:44:12.520658+0800 RACExample[45556:11658886] map -- 1
2020-05-28 14:44:12.520790+0800 RACExample[45556:11658886] subscribeNext -- 1
2020-05-28 14:44:12.520902+0800 RACExample[45556:11658886] &lt;RACReturnSignal: 0x60000023e360&gt; name:  completed
2020-05-28 14:44:12.521116+0800 RACExample[45556:11658886] signal -- 2
2020-05-28 14:44:12.521573+0800 RACExample[45556:11658886] map -- 2
2020-05-28 14:44:12.521995+0800 RACExample[45556:11658886] subscribeNext -- 2
2020-05-28 14:44:12.522413+0800 RACExample[45556:11658886] &lt;RACReturnSignal: 0x600000238520&gt; name:  completed
2020-05-28 14:44:12.522804+0800 RACExample[45556:11658886] signal -- 3
2020-05-28 14:44:12.537218+0800 RACExample[45556:11658886] map -- 3
2020-05-28 14:44:12.537473+0800 RACExample[45556:11658886] subscribeNext -- 3
2020-05-28 14:44:12.537624+0800 RACExample[45556:11658886] &lt;RACReturnSignal: 0x600000238560&gt; name:  completed
2020-05-28 14:44:12.537738+0800 RACExample[45556:11658886] signal -- 4
2020-05-28 14:44:12.537825+0800 RACExample[45556:11658886] map -- 4
2020-05-28 14:44:12.537941+0800 RACExample[45556:11658886] subscribeNext -- 4
2020-05-28 14:44:12.538046+0800 RACExample[45556:11658886] &lt;RACReturnSignal: 0x600000238580&gt; name:  completed
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h4 id="示例-1">示例</h4>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44</pre></td><td class="code"><pre class="highlight"><code><span class="c1">//创建一个普通信号</span>
<span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">NSInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">i</span><span class="p">)];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}];</span>

<span class="c1">//创建一个发送信号的信号，信号的信号</span>
<span class="n">RACSignal</span> <span class="o">*</span><span class="n">signalOfSignals</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">signal</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}];</span>

<span class="p">[</span><span class="n">signalOfSignals</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//不使用flattenMap，会打印出内部信号</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"订阅signalOfSignals：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>

<span class="p">[[</span><span class="n">signalOfSignals</span> <span class="nf">flattenMap</span><span class="p">:</span><span class="o">^</span><span class="n">__kindof</span> <span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="nf">filter</span><span class="p">:</span><span class="o">^</span><span class="n">BOOL</span><span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"filter：%@"</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="nf">integerValue</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="p">?</span> <span class="nb">YES</span><span class="p">:</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//使用flattenMap，会打印内部信号的值</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"使用flattenMap后订阅signalOfSignals：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>

<span class="cm">/*
2020-06-08 17:54:26.211401+0800 RACExample[51286:408356] 订阅signalOfSignals：&lt;RACDynamicSignal: 0x6000011c3880&gt; name: 
2020-06-08 17:54:26.213350+0800 RACExample[51286:408356] filter：0
2020-06-08 17:54:26.213911+0800 RACExample[51286:408356] filter：1
2020-06-08 17:54:26.214308+0800 RACExample[51286:408356] filter：2
2020-06-08 17:54:26.214501+0800 RACExample[51286:408356] 使用flattenMap后订阅signalOfSignals：2
2020-06-08 17:54:26.214642+0800 RACExample[51286:408356] filter：3
2020-06-08 17:54:26.214780+0800 RACExample[51286:408356] 使用flattenMap后订阅signalOfSignals：3
2020-06-08 17:54:26.214903+0800 RACExample[51286:408356] filter：4
2020-06-08 17:54:26.215048+0800 RACExample[51286:408356] 使用flattenMap后订阅signalOfSignals：4
2020-06-08 17:54:26.215221+0800 RACExample[51286:408356] filter：5
2020-06-08 17:54:26.215357+0800 RACExample[51286:408356] 使用flattenMap后订阅signalOfSignals：5
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号操作时间delay延迟">信号操作时间:delay(延迟)</h3>

<blockquote>
  <p>延迟发送next。</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}]</span> <span class="nf">delay</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext:%@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号操作时间interval定时">信号操作时间:interval(定时)</h3>

<blockquote>
  <p>每隔一段时间发出信号</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_interval_onScheduler</span><span class="p">{</span>
    <span class="p">[[</span><span class="n">RACSignal</span> <span class="nf">interval</span><span class="p">:</span><span class="mi">1</span> <span class="nf">onScheduler</span><span class="p">:[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]]</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"interval -- %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="c1">// 保证上面的延时操作得以完成</span>
    <span class="p">[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}]</span> <span class="nf">asynchronouslyWaitUntilCompleted</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">}</span>
<span class="cm">/*
2019-08-07 10:10:38.795691+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:38 2019
2019-08-07 10:10:39.796486+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:39 2019
2019-08-07 10:10:40.796486+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:40 2019
2019-08-07 10:10:41.796472+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:41 2019
2019-08-07 10:10:42.796452+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:42 2019
2019-08-07 10:10:43.796631+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:43 2019
2019-08-07 10:10:44.796494+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:44 2019
2019-08-07 10:10:45.796493+0800 RACDemo02[45596:1122009] interval -- Wed Aug  7 10:10:45 2019
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号操作时间timeout超时">信号操作时间:timeout(超时)</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">timeout</code>：超时，可以让一个信号在一定的时间后，自动报错。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]</span> <span class="nf">afterDelay</span><span class="p">:</span><span class="mi">3</span> <span class="nf">schedule</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="p">}];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}]</span> <span class="nf">timeout</span><span class="p">:</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="nf">onScheduler</span><span class="p">:[</span><span class="n">RACScheduler</span> <span class="nf">currentScheduler</span><span class="p">]]</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span> <span class="n">error</span><span class="o">:^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"error：%@"</span><span class="p">,</span><span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
<span class="p">}</span> <span class="n">completed</span><span class="o">:^</span><span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"completed"</span><span class="p">);</span>
<span class="p">}];</span>
<span class="cm">/*
error：The operation couldn’t be completed. (RACSignalErrorDomain error 1.)
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号过滤distinctuntilchanged">信号过滤:distinctUntilChanged</h3>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">distinctUntilChanged</code>:当上一次的值和当前的值有明显的变化就会发出信号，否则会被忽略掉。</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// distinctUntilChanged 只有输入合法才能进行打印</span>
<span class="n">RACSignal</span> <span class="o">*</span><span class="n">validSearchSignal</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="err">@</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}]</span><span class="nf">distinctUntilChanged</span><span class="p">];</span>
<span class="p">[</span><span class="n">validSearchSignal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"search text is valid %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
<span class="n">self</span><span class="p">.</span><span class="n">executeSearch</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithEnabled</span><span class="p">:</span><span class="n">validSearchSignal</span> <span class="nf">signalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="nf">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">executeSearchSignal</span><span class="p">];</span>
<span class="p">}];</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号过滤ignore忽略">信号过滤:ignore(忽略)</h3>

<blockquote>
  <p>忽略完某些值的信号，针对信号值的某一种状态进行忽略，忽略时不会发送消息。</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">textField</span><span class="p">.</span><span class="n">rac_textSignal</span> <span class="nf">ignore</span><span class="p">:</span><span class="s">@"123"</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>

<span class="cm">/*
2020-05-28 19:02:21.305235+0800 RACExample[54835:11820168] 1
2020-05-28 19:02:22.011735+0800 RACExample[54835:11820168] 12
2020-05-28 19:02:23.618772+0800 RACExample[54835:11820168] 1234
2020-05-28 19:02:24.323828+0800 RACExample[54835:11820168] 12345
2020-05-28 19:02:25.367480+0800 RACExample[54835:11820168] 123456
2020-05-28 19:02:26.316891+0800 RACExample[54835:11820168] 12345
2020-05-28 19:02:26.874963+0800 RACExample[54835:11820168] 1234
2020-05-28 19:02:29.028761+0800 RACExample[54835:11820168] 12
2020-05-28 19:02:29.442549+0800 RACExample[54835:11820168] 1
2020-05-28 19:02:30.029542+0800 RACExample[54835:11820168] 
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/06.gif" /></p>

<h3 id="信号过滤filter过滤">信号过滤:filter(过滤)</h3>

<blockquote>
  <p>过滤信号，使用它可以获取满足条件的信号,符合条件的信号才能发出消息。</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</pre></td><td class="code"><pre class="highlight"><code><span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">textLabel</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">textField</span><span class="p">.</span><span class="n">rac_textSignal</span> <span class="nf">filter</span><span class="p">:</span><span class="o">^</span><span class="n">BOOL</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"12345"</span><span class="p">];</span>
<span class="p">}];</span>

<span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">textField</span><span class="p">.</span><span class="n">rac_textSignal</span> <span class="nf">filter</span><span class="p">:</span><span class="o">^</span><span class="n">BOOL</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"12345"</span><span class="p">];</span>
<span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号合并combinelatest结合reduce聚合">信号合并:combineLatest(结合)、reduce(聚合)</h3>

<blockquote>
  <p>combineLatest: 将多个信号合并起来，并且拿到各个信号的最新的值,必须每个合并的signal至少都有过一次sendNext，才会触发合并的信号。combineLatest 功能和 zipWith一样。 <br />
reduce:用于信号发出的内容是元组，把信号发出元组的值聚合成一个值,一般都是先结合再聚合。</p>
</blockquote>

<p>combineLatest示例:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_combineLatest_1</span><span class="p">{</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectA</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectB</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectC</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    
    <span class="c1">// 三个对象同时发送信号，缺一不可</span>
    <span class="p">[</span><span class="n">subjectA</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subjectB</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@2</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subjectC</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@3</span><span class="p">];</span>

    <span class="p">[[</span><span class="n">RACSignal</span> <span class="nf">combineLatest</span><span class="p">:@[</span><span class="n">subjectA</span><span class="p">,</span><span class="n">subjectB</span><span class="p">,</span><span class="n">subjectC</span><span class="p">]]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// x 的类型为 RACTuple 元组类 -&gt; RACOneTuple、RACTwoTuple、RACThreeTuple、RACFourTuple</span>
         <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="cm">/*
     2020-05-28 18:54:23.910080+0800 RACExample[54517:11813771] &lt;RACTuple: 0x600002aa1410&gt; (
         1,
         2,
         3
     )
     */</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p>combineLatest、reduce示例:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>

    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectA</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectB</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectC</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    
    <span class="c1">// 三个对象同时发送信号，缺一不可</span>
    <span class="p">[</span><span class="n">subjectA</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"邮件AA"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subjectB</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"邮件BB"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subjectC</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"邮件CC"</span><span class="p">];</span>

    <span class="c1">// 遵守 NSFastEnumeration 协议的类都可成为数组</span>
    <span class="c1">// reduce block 参数可以自己根据信号设置</span>
    <span class="p">[[</span><span class="n">RACSignal</span> <span class="nf">combineLatest</span><span class="p">:@[</span><span class="n">subjectA</span><span class="p">,</span><span class="n">subjectB</span><span class="p">,</span><span class="n">subjectC</span><span class="p">]</span> <span class="nf">reduce</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">signalA</span><span class="p">,</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">signalB</span><span class="p">,</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">signalC</span><span class="p">){</span>
        <span class="c1">// 把这 三个中任意 一个发出的信号值 聚合成一个值 NSString 类型</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"A = %@ , B = %@ , C = %@"</span><span class="p">,</span><span class="n">signalA</span> <span class="p">,</span> <span class="n">signalB</span> <span class="p">,</span> <span class="n">signalC</span><span class="p">];</span>
    <span class="p">}]</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"聚合后三个值变成一个 NSString 类型的值： %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    
    <span class="c1">// 或者</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">textLabel</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">combineLatest</span><span class="p">:@[</span><span class="n">subjectA</span><span class="p">,</span><span class="n">subjectB</span><span class="p">,</span><span class="n">subjectC</span><span class="p">]</span> <span class="nf">reduce</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">signalA</span><span class="p">,</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">signalB</span><span class="p">,</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">signalC</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"A = %@ , B = %@ , C = %@"</span><span class="p">,</span><span class="n">signalA</span> <span class="p">,</span> <span class="n">signalB</span> <span class="p">,</span> <span class="n">signalC</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="err">}</span>
<span class="cm">/*
2020-05-28 14:28:01.127620+0800 RACExample[44949:11647817] 聚合后三个值变成一个 NSString 类型的值： A = 邮件AA , B = 邮件BB , C = 邮件CC
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号合并zipwith压缩">信号合并:zipWith(压缩)</h3>

<blockquote>
  <p>把两个信号压缩成一个信号，只有当两个信号同时发出信号内容时，并且把两个信号的内容合并成一个元组，才会触发压缩流的next事件。 <br />
使用 zipWith 时，两个信号必须同时发出信号内容</p>
</blockquote>

<p><img src="/assets/images/iOS/rac/05.png" width="50%" height="50%" /></p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">test_zipWith</span><span class="p">{</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signalA</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
    
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signalB</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="mi">@2</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="p">[[</span><span class="n">signalA</span> <span class="nf">zipWith</span><span class="p">:</span><span class="n">signalB</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// x 的类型为 RACTuple 元组类 -&gt; RACOneTuple、RACTwoTuple、RACThreeTuple、RACFourTuple</span>
         <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2020-05-28 18:38:30.014387+0800 RACExample[53947:11801545] &lt;RACTwoTuple: 0x600000560900&gt; (
    1,
    2
)
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号合并merge合并">信号合并:merge(合并)</h3>

<blockquote>
  <p>把多个信号合并为一个信号，任何一个信号有新值的时候就会调用 <br />
只要有一个信号被发出就会被监听</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectA</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectB</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="n">RACReplaySubject</span> <span class="o">*</span> <span class="n">subjectC</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACReplaySubject</span> <span class="nf">subject</span><span class="p">];</span>
    
    <span class="c1">// 三个对象发送信号（只需其中一个或多个发送信号时，合并的 信号对象 都可以在订阅的 block 接收到信息）</span>
    <span class="p">[</span><span class="n">subjectC</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"CC"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subjectA</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"AA"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subjectB</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"BB"</span><span class="p">];</span>
    
    <span class="c1">// 合并两个信号对象变成一个接收信号对象 subjectD , subjectD 订阅 接收 subjectB 和 subjectA 发送的信号,信号输入的顺序和信号merge的顺序有关联。</span>
    <span class="p">[[[</span><span class="n">subjectB</span> <span class="nf">merge</span><span class="p">:</span><span class="n">subjectA</span><span class="p">]</span> <span class="nf">merge</span><span class="p">:</span><span class="n">subjectC</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2020-05-28 14:16:49.377200+0800 RACExample[44542:11640972] BB
2020-05-28 14:16:49.377353+0800 RACExample[44542:11640972] AA
2020-05-28 14:16:49.377509+0800 RACExample[44542:11640972] CC
*/</span> 
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号拼接then连接">信号拼接:then(连接)</h3>

<ul>
  <li>使用then连接信号，上一个信号完成后，才会连接then返回的信号，所以then连接的上一个信号必须使用<code class="language-plaintext highlighter-rouge">sendCompleted</code>，否则后续信号无法执行。</li>
  <li>then连接的多个信号与concat不同的是：<strong>之前的信号会被忽略掉，即订阅信号只会接收到最后一个信号的值</strong>。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"signalOne"</span><span class="p">);</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalOne"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"信号被激活:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
<span class="cm">/*
2020-06-08 18:28:17.835711+0800 RACExample[52619:427692] signalOne
2020-06-08 18:28:17.836206+0800 RACExample[52619:427692] 信号被激活:signalOne
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>添加一个<code class="language-plaintext highlighter-rouge">then</code>信号：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[[[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"signalOne"</span><span class="p">);</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalOne"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}]</span> <span class="nf">then</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"signalTwo"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalTwo"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}]</span> <span class="nf">then</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"signalThree"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalThree"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"信号被激活:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
<span class="cm">/*
2020-06-08 18:34:42.158566+0800 RACExample[52963:432992] signalOne
2020-06-08 18:34:42.159054+0800 RACExample[52963:432992] signalTwo
2020-06-08 18:34:42.159283+0800 RACExample[52963:432992] signalThree
2020-06-08 18:34:42.159633+0800 RACExample[52963:432992] 信号被激活:signalThree
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="信号拼接concat合并">信号拼接:concat(合并)</h3>

<ul>
  <li>使用<code class="language-plaintext highlighter-rouge">concat</code>可以按序拼接多个信号，拼接后的信号按序执行。</li>
  <li>只有前面的信号执行<code class="language-plaintext highlighter-rouge">sendCompleted</code>，后面的信号才会被激活。</li>
</ul>

<p><img src="/assets/images/iOS/rac/04.png" width="50%" height="50%" /></p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signalOne</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalOne"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signalTwo</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalTwo"</span><span class="p">];</span>
<span class="c1">//        [subscriber sendCompleted];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signalThree</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalThree"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="c1">//拼接了三个信号，订阅之后，三个信号依次激活</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">concatSignal</span> <span class="o">=</span> <span class="p">[[</span><span class="n">signalOne</span> <span class="nf">concat</span><span class="p">:</span><span class="n">signalTwo</span><span class="p">]</span> <span class="nf">concat</span><span class="p">:</span><span class="n">signalThree</span><span class="p">];</span>
    <span class="p">[</span><span class="n">concatSignal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"信号被激活:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2020-06-08 18:20:53.103639+0800 RACExample[52202:421372] 信号被激活:signalOne
2020-06-08 18:20:53.103922+0800 RACExample[52202:421372] 信号被激活:signalTwo
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>从上面代码看出<code class="language-plaintext highlighter-rouge">signalOne-&gt;signalTwo-&gt;signalThree</code>按照顺序连接，但是在信号<code class="language-plaintext highlighter-rouge">signalTwo</code>中没发送<code class="language-plaintext highlighter-rouge">sendCompleted</code>，所以后面的信号<code class="language-plaintext highlighter-rouge">signalThree</code>没有被激活。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACSignal</span> <span class="o">*</span><span class="n">signalTwo</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"signalTwo"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}];</span>
<span class="cm">/*
2020-06-08 18:23:40.588477+0800 RACExample[52340:423182] 信号被激活:signalOne
2020-06-08 18:23:40.589093+0800 RACExample[52340:423182] 信号被激活:signalTwo
2020-06-08 18:23:40.589539+0800 RACExample[52340:423182] 信号被激活:signalThree
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="racobserve">RACObserve</h3>

<blockquote>
  <p>RACObserve : KVO 监听属性内容变化</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code><span class="p">[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">textLabel</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"KVO 监听到 age 内容发生变化 ，变为 %@ , thread = %@"</span><span class="p">,</span><span class="n">x</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span>
<span class="p">}];</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="其他使用">其他使用</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">replay重放</code>：当一个信号被多次订阅,反复播放内容</li>
</ul>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="raccommand">RACCommand</h2>

<blockquote>
  <p>RACCommand：处理事件的操作,和UI关联.(主线程中执行)，最常用于两个地方，监听按钮点击，网络请求。</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</pre></td><td class="code"><pre class="highlight"><code><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">executionSignals</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">NSNumber</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">executing</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">NSNumber</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">enabled</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">NSError</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">errors</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">atomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">allowsConcurrentExecution</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithSignalBlock</span><span class="p">:(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">*</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">InputType</span> <span class="n">_Nullable</span> <span class="n">input</span><span class="p">))</span><span class="nv">signalBlock</span><span class="p">;</span>
<span class="c1">// 初始化RACCommand的入参enabledSignal就决定了RACCommand是否能开始执行。入参enabledSignal就是触发条件。</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithEnabled</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">NSNumber</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nv">enabledSignal</span> <span class="nf">signalBlock</span><span class="p">:(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">*</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">InputType</span> <span class="n">_Nullable</span> <span class="n">input</span><span class="p">))</span><span class="nv">signalBlock</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">ValueType</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nf">execute</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">InputType</span><span class="p">)</span><span class="nv">input</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">executionSignals</code>:是一个高阶信号，所以在使用的时候需要进行降阶操作(<code class="language-plaintext highlighter-rouge">flatten</code>，<code class="language-plaintext highlighter-rouge">switchToLatest</code>，<code class="language-plaintext highlighter-rouge">concat</code>)，降阶的方式根据需求来选取。一般选择的原则：一般不允许并发(<code class="language-plaintext highlighter-rouge">dispatch_queue_concurrent</code>)的<code class="language-plaintext highlighter-rouge">RACCommand</code>使用<code class="language-plaintext highlighter-rouge">switchToLatest</code>，允许并发的使用<code class="language-plaintext highlighter-rouge">flatten</code>。</p>

<p><code class="language-plaintext highlighter-rouge">executing</code>:表示了当前<code class="language-plaintext highlighter-rouge">RACCommand</code>是否在执行，信号里面的值都是<code class="language-plaintext highlighter-rouge">BOOL</code>类型的。<code class="language-plaintext highlighter-rouge">YES</code>表示的是<code class="language-plaintext highlighter-rouge">RACCommand</code>正在执行过程中，命名也说明的是正在进行时ing。<code class="language-plaintext highlighter-rouge">NO</code>表示的是<code class="language-plaintext highlighter-rouge">RACCommand</code>没有被执行或者已经执行结束。</p>

<p><code class="language-plaintext highlighter-rouge">enabled</code>: 信号就是一个开关，判断<code class="language-plaintext highlighter-rouge">RACCommand</code>是否可用:<br /></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">RACCommand</code> 初始化传入的<code class="language-plaintext highlighter-rouge">enabledSignal</code>信号，如果返回<code class="language-plaintext highlighter-rouge">NO</code>，那么<code class="language-plaintext highlighter-rouge">enabled</code>信号就返回<code class="language-plaintext highlighter-rouge">NO</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">RACCommand</code>开始执行中，<code class="language-plaintext highlighter-rouge">allowsConcurrentExecution</code>为<code class="language-plaintext highlighter-rouge">NO</code>，那么<code class="language-plaintext highlighter-rouge">enabled</code>信号就返回<code class="language-plaintext highlighter-rouge">NO</code>。</li>
  <li>除去以上2种情况以外，<code class="language-plaintext highlighter-rouge">enabled</code>信号基本都是返回YES。</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">errors</code>: 信号就是<code class="language-plaintext highlighter-rouge">RACCommand</code>执行过程中产生的错误信号。</p>

<blockquote>
  <p>在对<code class="language-plaintext highlighter-rouge">RACCommand</code>进行错误处理的时候，我们不应该使用<code class="language-plaintext highlighter-rouge">subscribeError:</code>对<code class="language-plaintext highlighter-rouge">RACCommand</code>的<code class="language-plaintext highlighter-rouge">executionSignals</code> 进行错误的订阅，因为<code class="language-plaintext highlighter-rouge">executionSignals</code>这个信号是不会发送<code class="language-plaintext highlighter-rouge">error</code>事件的。</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// 用subscribeNext:去订阅错误信号。</span>
<span class="p">[</span><span class="n">commandSignal</span><span class="p">.</span><span class="n">errors</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>     
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"ERROR! --&gt; %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">allowsConcurrentExecution</code>: 用来表示当前<code class="language-plaintext highlighter-rouge">RACCommand</code>是否允许并发执行。默认值是<code class="language-plaintext highlighter-rouge">NO</code>。按照上面说的则<code class="language-plaintext highlighter-rouge">enabled</code>的值也会为<code class="language-plaintext highlighter-rouge">NO</code>。</p>

<p><code class="language-plaintext highlighter-rouge">allowsConcurrentExecution</code>在具体实现中是用的<code class="language-plaintext highlighter-rouge">volatile</code>原子的操作，在实现中重写了它的get和set方法。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// 重写 get方法</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">allowsConcurrentExecution</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">_allowsConcurrentExecution</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 重写 set方法</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setAllowsConcurrentExecution</span><span class="p">:(</span><span class="n">BOOL</span><span class="p">)</span><span class="nv">allowed</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">willChangeValueForKey</span><span class="p">:</span><span class="err">@keypath</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">allowsConcurrentExecution</span><span class="p">)];</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">allowed</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// OSAtomicOr32Barrier是原子运算，它的意义是进行逻辑的“或”运算。通过原子性操作访问被volatile修饰的_allowsConcurrentExecution对象即可保障函数只执行一次。</span>
        <span class="n">OSAtomicOr32Barrier</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_allowsConcurrentExecution</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// OSAtomicAnd32Barrier是原子运算，它的意义是进行逻辑的“与”运算。</span>
        <span class="n">OSAtomicAnd32Barrier</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_allowsConcurrentExecution</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="p">[</span><span class="n">self</span> <span class="nf">didChangeValueForKey</span><span class="p">:</span><span class="err">@keypath</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">allowsConcurrentExecution</span><span class="p">)];</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><code class="language-plaintext highlighter-rouge">initWithSignalBlock:</code>与<code class="language-plaintext highlighter-rouge">initWithEnabled:signalBlock:</code>的区别：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithSignalBlock</span><span class="p">:(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span> <span class="o">*</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">id</span> <span class="n">input</span><span class="p">))</span><span class="nv">signalBlock</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">initWithEnabled</span><span class="p">:</span><span class="nb">nil</span> <span class="nf">signalBlock</span><span class="p">:</span><span class="n">signalBlock</span><span class="p">];</span><span class="c1">// nil 相当于：[RACSignal return:@YES]</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="使用">使用</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACCommand</span> <span class="o">*</span><span class="n">command</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSignalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"发送信号：%@"</span><span class="p">,</span><span class="n">input</span><span class="p">);</span><span class="c1">//2</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">input</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendError</span><span class="p">:[</span><span class="n">NSError</span> <span class="nf">errorWithDomain</span><span class="p">:</span><span class="s">@""</span> <span class="nf">code</span><span class="p">:</span><span class="mi">0</span> <span class="nf">userInfo</span><span class="p">:@{</span><span class="n">NSLocalizedDescriptionKey</span><span class="o">:</span><span class="s">@"----"</span><span class="p">}]];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}];</span>
<span class="p">[</span><span class="n">command</span><span class="p">.</span><span class="n">executionSignals</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"收到信号(subscribeNext)：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="c1">// 我们可以在这里把处理事件(网络请求、逻辑处理)之前的逻辑(showHUD...)放到这。</span>
    
    <span class="p">[</span><span class="n">x</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"x-收到信号(subscribeNext)：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="c1">// 收到信号B：1</span>
    <span class="p">}</span> <span class="nf">error</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"x-收到信号(error)：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="c1">//收不到error，因为 executionSignals 不会处理 error</span>
    <span class="p">}</span> <span class="n">completed</span><span class="o">:^</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"x-收到信号(completed)"</span><span class="p">);</span>
    <span class="p">}];</span>

<span class="p">}</span> <span class="nf">error</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"收到信号(error)：%@"</span><span class="p">,</span><span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span><span class="c1">//收不到error，因为 executionSignals 不会处理 error</span>
<span class="p">}</span> <span class="n">completed</span><span class="o">:^</span><span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"收到信号(completed)"</span><span class="p">);</span>
<span class="p">}];</span>
<span class="p">[</span><span class="n">command</span> <span class="nf">execute</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
<span class="cm">/*
收到信号(subscribeNext)：&lt;RACDynamicSignal: 0x60000318f5a0&gt; name: 
发送信号：1
x-收到信号(subscribeNext)：1
x-收到信号(completed)
收到信号(completed)
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>换一种方式进行信号处理：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACCommand</span> <span class="o">*</span><span class="n">command</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSignalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"发送信号：%@"</span><span class="p">,</span><span class="n">input</span><span class="p">);</span><span class="c1">//2</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">input</span><span class="p">];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendError</span><span class="p">:[</span><span class="n">NSError</span> <span class="nf">errorWithDomain</span><span class="p">:</span><span class="s">@""</span> <span class="nf">code</span><span class="p">:</span><span class="mi">0</span> <span class="nf">userInfo</span><span class="p">:@{</span><span class="n">NSLocalizedDescriptionKey</span><span class="o">:</span><span class="s">@"----"</span><span class="p">}]];</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}];</span>
<span class="c1">// 通过 switchToLatest 把高阶信号降阶处理。</span>
<span class="p">[[</span><span class="n">command</span><span class="p">.</span><span class="n">executionSignals</span> <span class="nf">switchToLatest</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"收到信号(switchToLatest)：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
<span class="p">[</span><span class="n">command</span><span class="p">.</span><span class="n">errors</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"收到信号(errors)：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
<span class="p">}];</span>
<span class="p">[</span><span class="n">command</span><span class="p">.</span><span class="n">executing</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">([</span><span class="n">x</span> <span class="nf">boolValue</span><span class="p">]</span> <span class="o">==</span> <span class="nb">YES</span><span class="p">){</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACCommand命令正在执行..."</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACCommand命令不在执行中！！！"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}];</span>
<span class="p">[</span><span class="n">command</span> <span class="nf">execute</span><span class="p">:</span><span class="mi">@1</span><span class="p">];</span>
<span class="cm">/*
RACCommand命令不在执行中！！！
RACCommand命令正在执行...     &lt;==== 我们可以在这里把处理事件(网络请求、逻辑处理)之前的逻辑(showHUD...)放到这。
发送信号：1
收到信号(switchToLatest)：1
收到信号(errors)：----
RACCommand命令不在执行中！！！
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>我们对<code class="language-plaintext highlighter-rouge">executing</code>进行一下处理，去掉无用的触发。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[[</span><span class="n">command</span><span class="p">.</span><span class="n">executing</span> <span class="nf">skip</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">take</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">([</span><span class="n">x</span> <span class="nf">boolValue</span><span class="p">]</span> <span class="o">==</span> <span class="nb">YES</span><span class="p">){</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACCommand命令正在执行..."</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RACCommand命令不在执行中！！！"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}];</span>
<span class="cm">/*
2020-06-08 17:00:00.488046+0800 RACExample[49056:380458] RACCommand命令正在执行...
2020-06-08 17:00:00.488513+0800 RACExample[49056:380458] 发送信号：1
2020-06-08 17:00:00.488740+0800 RACExample[49056:380458] 收到信号(switchToLatest)：1
2020-06-08 17:00:00.489372+0800 RACExample[49056:380458] 收到信号(errors)：----
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<p>或者直接订阅信号：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12</pre></td><td class="code"><pre class="highlight"><code><span class="p">[[</span><span class="n">command</span> <span class="nf">execute</span><span class="p">:</span><span class="mi">@1</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"接收信号(subscribeNext)：%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span> <span class="nf">error</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"接收信号(error)：%@"</span><span class="p">,</span><span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
<span class="p">}</span> <span class="n">completed</span><span class="o">:^</span><span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"接收信号(completed)"</span><span class="p">);</span>
<span class="p">}];</span>
<span class="cm">/*
发送信号：1
接收信号(subscribeNext)：1
接收信号(error)：----
*/</span>
</code></pre></td></tr></tbody></table></div></div>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="racchannel">RACChannel</h2>

<h3 id="racchannel实现双向绑定"><a href="https://blog.harrisonxi.com/2017/07/RAC%E4%B8%AD%E7%94%A8RACChannel%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A.html">RACChannel实现双向绑定</a></h3>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="foundation">Foundation</h2>

<p>涉及<code class="language-plaintext highlighter-rouge">Foundation</code>相关的RAC分类:<code class="language-plaintext highlighter-rouge">NSArray</code>、<code class="language-plaintext highlighter-rouge">NSData</code>、<code class="language-plaintext highlighter-rouge">NSDictionary</code>、<code class="language-plaintext highlighter-rouge">NSEnumerator</code>、<code class="language-plaintext highlighter-rouge">NSFileHandle</code>、<code class="language-plaintext highlighter-rouge">NSIndexSet</code>、<code class="language-plaintext highlighter-rouge">NSInvocation</code>、<code class="language-plaintext highlighter-rouge">NSNotificationCenter</code>、<code class="language-plaintext highlighter-rouge">NSObject</code>、<code class="language-plaintext highlighter-rouge">NSOrderedSet</code>、<code class="language-plaintext highlighter-rouge">NSSet</code>、<code class="language-plaintext highlighter-rouge">NSString</code>、<code class="language-plaintext highlighter-rouge">NSURLConnection</code>、<code class="language-plaintext highlighter-rouge">NSUserDefaults</code>。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21</pre></td><td class="code"><pre class="highlight"><code>NSArray+RACSequenceAdditions.h
NSData+RACSupport.h
NSDictionary+RACSequenceAdditions.h
NSEnumerator+RACSequenceAdditions.h
NSFileHandle+RACSupport.h
NSIndexSet+RACSequenceAdditions.h
NSInvocation+RACTypeParsing.h
NSNotificationCenter+RACSupport.h
NSObject+RACDeallocating.h
NSObject+RACDescription.h
NSObject+RACKVOWrapper.h
NSObject+RACLifting.h
NSObject+RACPropertySubscribing.h
NSObject+RACSelectorSignal.h
NSOrderedSet+RACSequenceAdditions.h
NSSet+RACSequenceAdditions.h
NSString+RACKeyPathUtilities.h
NSString+RACSequenceAdditions.h
NSString+RACSupport.h
NSURLConnection+RACSupport.h
NSUserDefaults+RACSupport.h
</code></pre></td></tr></tbody></table></div></div>

<h3 id="nsobject">NSObject</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6</pre></td><td class="code"><pre class="highlight"><code>NSObject+RACDeallocating.h
NSObject+RACDescription.h
NSObject+RACKVOWrapper.h
NSObject+RACLifting.h
NSObject+RACPropertySubscribing.h
NSObject+RACSelectorSignal.h
</code></pre></td></tr></tbody></table></div></div>

<h4 id="nsobjectraclifting">NSObject+RACLifting</h4>

<blockquote>
  <p>等待成所有的 RACSignal 对象发送完信号再执行方法) (主程中执行)</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">rac_liftSelector</span><span class="p">:(</span><span class="n">SEL</span><span class="p">)</span><span class="nv">selector</span> <span class="nf">withSignals</span><span class="p">:(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nv">firstSignal</span><span class="p">,</span> <span class="p">...</span> <span class="n">NS_REQUIRES_NIL_TERMINATION</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">rac_liftSelector</span><span class="p">:(</span><span class="n">SEL</span><span class="p">)</span><span class="nv">selector</span> <span class="nf">withSignalsFromArray</span><span class="p">:(</span><span class="n">NSArray</span><span class="o">&lt;</span><span class="n">RACSignal</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nv">signals</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">rac_liftSelector</span><span class="p">:(</span><span class="n">SEL</span><span class="p">)</span><span class="nv">selector</span> <span class="nf">withSignalOfArguments</span><span class="p">:(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">RACTuple</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nv">arguments</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div></div>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">test_rac_lift</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="n">RACSignal</span> <span class="o">*</span> <span class="n">signalOne</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 现在想发出信号了</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"网络请求数据 1"</span><span class="p">];</span>
        <span class="c1">// 不需要释放操作</span>
        <span class="k">return</span> <span class="nb">nil</span> <span class="p">;</span>
    <span class="p">}];</span>
    
    <span class="n">RACSignal</span> <span class="o">*</span> <span class="n">signalTwo</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 现在想发出信号了</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"网络请求数据 2"</span><span class="p">];</span>
        <span class="c1">// 不需要释放操作</span>
        <span class="k">return</span> <span class="nb">nil</span> <span class="p">;</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">rac_liftSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nf">updateUIWithSignalOneMessage</span><span class="p">:</span><span class="n">signalTwoMessage</span><span class="o">:</span><span class="p">)</span> <span class="n">withSignalsFromArray</span><span class="o">:</span><span class="p">@[</span><span class="n">signalOne</span><span class="p">,</span><span class="n">signalTwo</span><span class="p">]];</span>
<span class="p">}</span>
<span class="c1">// 当所有数据都拿到手后更新UI , 传的数据就是 signalOne 和 signalTwo 发出来的信号数据 ，(所以当前设计的接收方法 也必需要有两个参数，发出的信号按顺序 传参)</span>
<span class="c1">// 假如当前对象方法只设计 传一个参数，那么就会导致崩溃</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">updateUIWithSignalOneMessage</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">signalOneMessage</span> <span class="nf">signalTwoMessage</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">signalTwoMessage</span><span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"signalOneMessage = %@ , signalTwoMessage = %@ , thread = %@"</span><span class="p">,</span><span class="n">signalOneMessage</span><span class="p">,</span><span class="n">signalTwoMessage</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span>
<span class="p">}</span>
<span class="c1">//signalOneMessage = 网络请求数据 1 , signalTwoMessage = 网络请求数据 2 , thread = &lt;NSThread: 0x600002f704c0&gt;{number = 1, name = main}</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="nsnotificationcenter">NSNotificationCenter</h3>

<blockquote>
  <p>RAC 把监听通知的方法改成了 block 形式</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// NSNotificationCenter+RACSupport.h</span>

<span class="k">-</span> <span class="p">(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">NSNotification</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nf">rac_addObserverForName</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">notificationName</span> <span class="nf">object</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">object</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div></div>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">test_rac_addObserverForName</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="p">[[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span> <span class="nf">rac_addObserverForName</span><span class="p">:</span><span class="n">UIKeyboardDidHideNotification</span> <span class="nf">object</span><span class="p">:</span><span class="nf">nil</span><span class="p">]</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"NSNotification 1 x = %@"</span><span class="p">,</span><span class="n">x</span><span class="p">.</span><span class="n">userInfo</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span> <span class="nf">rac_addObserverForName</span><span class="p">:</span><span class="n">UIKeyboardDidHideNotification</span> <span class="nf">object</span><span class="p">:</span><span class="nf">nil</span><span class="p">]</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"NSNotification 2 x = %@"</span><span class="p">,</span><span class="n">x</span><span class="p">.</span><span class="n">userInfo</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span> <span class="nf">postNotificationName</span><span class="p">:</span><span class="n">UIKeyboardDidHideNotification</span> <span class="nf">object</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    
    <span class="c1">// NSNotification 1 x = (null)</span>
    <span class="c1">// NSNotification 2 x = (null)</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="nsstring">NSString</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code>NSString+RACKeyPathUtilities.h
NSString+RACSequenceAdditions.h
NSString+RACSupport.h
</code></pre></td></tr></tbody></table></div></div>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="uikit">UIKit</h2>

<p>涉及<code class="language-plaintext highlighter-rouge">UIKit</code>相关的RAC分类：<code class="language-plaintext highlighter-rouge">UIActionSheet</code>、<code class="language-plaintext highlighter-rouge">UIAlertView</code>、<code class="language-plaintext highlighter-rouge">UIBarButtonItem</code>、<code class="language-plaintext highlighter-rouge">UIButton</code>、<code class="language-plaintext highlighter-rouge">UICollectionReusableView</code>、<code class="language-plaintext highlighter-rouge">UIControl</code>、<code class="language-plaintext highlighter-rouge">UIControl</code>、<code class="language-plaintext highlighter-rouge">UIDatePicker</code>、<code class="language-plaintext highlighter-rouge">UIGestureRecognizer</code>、<code class="language-plaintext highlighter-rouge">UIImagePickerController</code>、<code class="language-plaintext highlighter-rouge">UIRefreshControl</code>、<code class="language-plaintext highlighter-rouge">UISegmentedControl</code>、<code class="language-plaintext highlighter-rouge">UISlider</code>、<code class="language-plaintext highlighter-rouge">UIStepper</code>、<code class="language-plaintext highlighter-rouge">UISwitch</code>、<code class="language-plaintext highlighter-rouge">UITableViewCell</code>、<code class="language-plaintext highlighter-rouge">UITableViewHeaderFooterView</code>、<code class="language-plaintext highlighter-rouge">UITextField</code>、<code class="language-plaintext highlighter-rouge">UITextView</code>。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19</pre></td><td class="code"><pre class="highlight"><code>UIActionSheet+RACSignalSupport.h
UIAlertView+RACSignalSupport.h
UIBarButtonItem+RACCommandSupport.h
UIButton+RACCommandSupport.h
UICollectionReusableView+RACSignalSupport.h
UIControl+RACSignalSupport.h
UIControl+RACSignalSupportPrivate.h
UIDatePicker+RACSignalSupport.h
UIGestureRecognizer+RACSignalSupport.h
UIImagePickerController+RACSignalSupport.h
UIRefreshControl+RACCommandSupport.h
UISegmentedControl+RACSignalSupport.h
UISlider+RACSignalSupport.h
UIStepper+RACSignalSupport.h
UISwitch+RACSignalSupport.h
UITableViewCell+RACSignalSupport.h
UITableViewHeaderFooterView+RACSignalSupport.h
UITextField+RACSignalSupport.h
UITextView+RACSignalSupport.h
</code></pre></td></tr></tbody></table></div></div>

<h3 id="uicontrolracsignalsupportprivate">UIControl+RACSignalSupportPrivate</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">RACChannelTerminal</span> <span class="o">*</span><span class="p">)</span><span class="nf">rac_channelForControlEvents</span><span class="p">:(</span><span class="n">UIControlEvents</span><span class="p">)</span><span class="nv">controlEvents</span> <span class="nf">key</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span> <span class="nf">nilValue</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">nilValue</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div></div>

<pre><code class="language-ojbc">// 按钮点击响应
[[self.loginButton rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(__kindof UIControl * _Nullable x) { 
}];
</code></pre>

<h3 id="uitextfieldracsignalsupport">UITextField+RACSignalSupport</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">RACSignal</span><span class="o">&lt;</span><span class="n">NSString</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="n">rac_textSignal</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">RACChannelTerminal</span><span class="o">&lt;</span><span class="n">NSString</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="n">rac_newTextChannel</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div></div>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">textField</span> <span class="nf">rac_textSignal</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"text = %@ , textField.text = %@ , thread = %@"</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">textField</span><span class="p">.</span><span class="n">text</span><span class="p">,[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]);</span>
    <span class="p">}];</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">textLabel</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">textField</span><span class="p">.</span><span class="n">rac_textSignal</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/01.gif" /></p>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="信号相关类">信号相关类</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9</pre></td><td class="code"><pre class="highlight"><code>RACDynamicSignal.h
RACEmptySignal.h
RACErrorSignal.h
RACGroupedSignal.h
RACReturnSignal.h
RACSignal+Operations.h
RACSignal.h
RACSignalProvider.d
RACSignalSequence.h
</code></pre></td></tr></tbody></table></div></div>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="rac_deallocdisposablerac_deallocdisposablerac_prepareforreusesignal">rac_deallocDisposable、rac_deallocDisposable、rac_prepareForReuseSignal</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">NSObject</code> : <code class="language-plaintext highlighter-rouge">rac_deallocDisposable</code></li>
  <li><code class="language-plaintext highlighter-rouge">NSObject</code> : <code class="language-plaintext highlighter-rouge">rac_willDeallocSignal</code></li>
  <li><code class="language-plaintext highlighter-rouge">UITableViewCell</code> : <code class="language-plaintext highlighter-rouge">rac_prepareForReuseSignal</code></li>
</ul>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="tips">Tips</h2>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">HomeViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">searchConditons</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACSignal</span>  <span class="o">*</span><span class="n">searchBtnEnableSignal</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">HomeViewModel</span>
<span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setUp</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setUp</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">setupSearchBtnEnableSignal</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setupSearchBtnEnableSignal</span> <span class="p">{</span>
    <span class="n">_searchBtnEnableSignal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">combineLatest</span><span class="p">:@[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">searchConditons</span><span class="p">)]</span> <span class="nf">reduce</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">searchConditions</span><span class="p">){</span>
        <span class="k">return</span> <span class="err">@</span><span class="p">(</span><span class="n">searchConditions</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="c1">// =====================================================</span>

<span class="k">@interface</span> <span class="nc">MovieViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">requestCommand</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSArray</span> <span class="o">*</span><span class="n">movies</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">MovieViewModel</span>

<span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setup</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setup</span> <span class="p">{</span>
    <span class="n">_requestCommand</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSignalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
        <span class="n">RACSignal</span> <span class="o">*</span><span class="n">requestSignal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NetworkManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">NetworkManager</span> <span class="nf">manager</span><span class="p">];</span>
            <span class="p">[</span><span class="n">manager</span> <span class="nf">getDataWithUrl</span><span class="p">:</span><span class="s">@"https://api.douban.com/v2/movie/search"</span> <span class="nf">parameters</span><span class="p">:</span><span class="n">input</span> <span class="n">success</span><span class="o">:^</span><span class="p">(</span><span class="n">id</span> <span class="n">json</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">json</span><span class="p">];</span>
                <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
            <span class="p">}</span> <span class="n">failure</span><span class="o">:^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                
            <span class="p">}];</span>
            
            <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="p">}];</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">requestSignal</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">dictArray</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s">@"subjects"</span><span class="p">];</span>
            <span class="n">NSArray</span> <span class="o">*</span><span class="n">modelArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictArray</span><span class="p">.</span><span class="n">rac_sequence</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">id</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">Movie</span> <span class="nf">movieWithDict</span><span class="p">:</span><span class="n">value</span><span class="p">];</span>
            <span class="p">}].</span><span class="n">array</span><span class="p">;</span>
           <span class="n">NSSortDescriptor</span> <span class="o">*</span><span class="n">sortDescriptor</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSSortDescriptor</span> <span class="nf">sortDescriptorWithKey</span><span class="p">:</span><span class="s">@"year"</span> <span class="nf">ascending</span><span class="p">:</span><span class="nb">NO</span><span class="p">];</span>
            <span class="n">_movies</span> <span class="o">=</span> <span class="p">[</span><span class="n">modelArray</span> <span class="nf">sortedArrayUsingDescriptors</span><span class="p">:@[</span><span class="n">sortDescriptor</span><span class="p">]];</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">_movies</span><span class="p">.</span><span class="n">description</span><span class="p">);</span>
            
            <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p>在两个VM中，一个用的是<code class="language-plaintext highlighter-rouge">RACSignal</code>，一个用的是<code class="language-plaintext highlighter-rouge">RACCommand</code>：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">RACSignal</code>是单向的，就像1个人在做演讲，观众听到就结束了</li>
  <li><code class="language-plaintext highlighter-rouge">RACCommand</code>是双向的，演讲者做演讲，下面的观众听到后还反馈了意见，而演讲者对反馈还做了回复。(V中发出命令，VM收到命令后进行网络请求，并将获取的网络数据包发送出去，V对收到的数据进行解析和显示)。</li>
</ul>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="racmvvm开发规约">RAC&amp;MVVM开发规约</h2>

<h3 id="vm层">VM层</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// =============================.h=============================</span>
<span class="k">@interface</span> <span class="nc">WLMSelectedApplyMerchantVM</span> <span class="p">:</span><span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">requestCommand</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">messageSubject</span><span class="p">;</span>
<span class="k">@end</span>
<span class="c1">// =============================.m=============================</span>
<span class="k">@interface</span> <span class="nc">WLMSelectedApplyMerchantVM</span><span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readwrite</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">requestCommand</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">,</span> <span class="n">readwrite</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">messageSubject</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">WLMSelectedApplyMerchantVM</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">dealloc</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">requestCommand</span> <span class="nf">rac_deallocDisposable</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">messageSubject</span> <span class="nf">rac_deallocDisposable</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{</span>

    <span class="c1">//@weakify(self);</span>
    <span class="n">_requestCommand</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSignalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//@strongify(self);</span>

            <span class="c1">// Code here...</span>
            
            <span class="k">return</span> <span class="p">[</span><span class="n">RACDisposable</span> <span class="nf">disposableWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">}];</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Publish Methods
</span>
<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - Getter
</span><span class="k">-</span><span class="p">(</span><span class="n">RACSubject</span> <span class="o">*</span><span class="p">)</span><span class="n">messageSubject</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_messageSubject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_messageSubject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_messageSubject</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Stter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="v层">V层</h3>

<h4 id="controller">Controller</h4>
<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// =============================.h=============================</span>
<span class="k">@interface</span> <span class="nc">LoginViewController</span> <span class="p">:</span> <span class="nc">UIViewController</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">RACAndMVVMViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">;</span>
<span class="k">@end</span>
<span class="c1">// =============================.m=============================</span>
<span class="k">@interface</span> <span class="nc">LoginViewController</span> <span class="p">()</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACAndMVVMViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">LoginViewController</span>
<span class="cp">#pragma mark - life cycle
</span><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">RACAndMVVMViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="n">viewModel</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateViewConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateViewConstraints</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">RACAndMVVMViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACAndMVVMViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p>有些方案会把<code class="language-plaintext highlighter-rouge">Controller</code>中的<code class="language-plaintext highlighter-rouge">View</code>也自定义出来，成为主<code class="language-plaintext highlighter-rouge">View</code>，具体样例：</p>

<p>VM层：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26</pre></td><td class="code"><pre class="highlight"><code><span class="cp">#pragma mark - ====================VM层====================
</span><span class="k">@interface</span> <span class="nc">LoginMainViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="c1">// Demo RACSubject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">pushSubject</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">LoginMainViewModel</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - business
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span> <span class="p">(</span><span class="n">RACSubject</span> <span class="o">*</span><span class="p">)</span><span class="n">pushSubject</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_pushSubject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_pushSubject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_pushSubject</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p>主View层：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45</pre></td><td class="code"><pre class="highlight"><code><span class="cp">#pragma mark - ====================V层====================
</span><span class="k">@interface</span> <span class="nc">LoginMainView</span> <span class="p">:</span> <span class="nc">UIView</span>
<span class="c1">// Demo Button</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">UIButton</span><span class="o">*</span> <span class="n">button</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">LoginMainViewModel</span><span class="o">*</span> <span class="n">viewModel</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">LoginMainViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">LoginMainView</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">LoginMainViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="n">viewModel</span><span class="p">;</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">updateConstraints</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateConstraints</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="c1">// Demo sendNext</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">button</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">pushSubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"1"</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">LoginMainViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LoginMainViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p>Controller层：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52</pre></td><td class="code"><pre class="highlight"><code><span class="cp">#pragma mark - ====================V层====================
</span><span class="k">@interface</span> <span class="nc">LoginViewController</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">LoginMainView</span> <span class="o">*</span><span class="n">mainView</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">LoginMainViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">LoginViewController</span>
<span class="cp">#pragma mark - life cycle
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">mainView</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateViewConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">mainView</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">edges</span><span class="p">.</span><span class="n">mas_equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateViewConstraints</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="c1">// Demo subscribeNext</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">pushSubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">navigationController</span> <span class="nf">pushViewController</span><span class="p">:[</span><span class="n">UIViewController</span> <span class="nf">new</span><span class="p">]</span> <span class="nf">animated</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span> <span class="p">(</span><span class="n">LoginMainView</span> <span class="o">*</span><span class="p">)</span><span class="n">mainView</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_mainView</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_mainView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LoginMainView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithViewModel</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_mainView</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="n">LoginMainViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LoginMainViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h4 id="自定义uiview">自定义UIView</h4>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span>  <span class="nc">LoginTableView</span><span class="p">:</span> <span class="nc">UIView</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">LoginTableViewModel</span><span class="o">*</span> <span class="n">viewModel</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">LoginTableViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">LoginTableView</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">LoginTableViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="n">viewModel</span><span class="p">;</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">updateConstraints</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateConstraints</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">LoginTableViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LoginTableViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h4 id="自定义复用机制uiview">自定义复用机制UIView</h4>

<blockquote>
  <p>有复用机制的View：UICollectionviewCell、UITableViewCell…,因为有复用机制，会有部份cell不会走<code class="language-plaintext highlighter-rouge">init</code>方法，而是直接走<code class="language-plaintext highlighter-rouge">cell复用池</code>。</p>
</blockquote>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span>  <span class="nc">LoginTableViewCell</span><span class="p">:</span> <span class="nc">UITableViewCell</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSIndexPath</span> <span class="o">*</span><span class="n">indexPath</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">CircleListMainViewCellViewModel</span><span class="o">*</span> <span class="n">viewModel</span><span class="p">;</span>

<span class="k">+</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">reuseIdentifier</span><span class="p">;</span>
<span class="k">+</span><span class="p">(</span><span class="n">CircleListMainViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellWithTableView</span><span class="p">:(</span><span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">indexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">LoginTableViewCell</span>
<span class="cp">#pragma mark - Init Views
</span><span class="k">+</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">reuseIdentifier</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">NSStringFromClass</span><span class="p">([</span><span class="n">self</span> <span class="nf">class</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">+</span><span class="p">(</span><span class="n">CircleListMainViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellWithTableView</span><span class="p">:(</span><span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">indexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
    <span class="n">CircleListMainViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nf">dequeueReusableCellWithIdentifier</span><span class="p">:[</span><span class="n">self</span> <span class="nf">reuseIdentifier</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cell</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithStyle</span><span class="p">:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nf">reuseIdentifier</span><span class="p">:[</span><span class="n">self</span> <span class="nf">reuseIdentifier</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">indexPath</span> <span class="o">=</span> <span class="n">indexPath</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithStyle</span><span class="p">:(</span><span class="n">UITableViewCellStyle</span><span class="p">)</span><span class="nv">style</span> <span class="nf">reuseIdentifier</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">reuseIdentifier</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithStyle</span><span class="p">:</span><span class="n">style</span> <span class="nf">reuseIdentifier</span><span class="p">:</span><span class="n">reuseIdentifier</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">selectionStyle</span> <span class="o">=</span> <span class="n">UITableViewCellSelectionStyleNone</span><span class="p">;</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">updateConstraints</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateConstraints</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{}</span>

<span class="cp">#pragma mark - getter
</span>
<span class="cp">#pragma mark setter
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setViewModel</span><span class="p">:(</span><span class="n">LoginTableViewCellViewModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">{</span>
    <span class="n">_viewModel</span> <span class="o">=</span> <span class="n">viewModel</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">viewModel</span><span class="p">)</span>  <span class="k">return</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="mvvmrac">MVVM&amp;RAC</h2>

<h3 id="使用设计">使用设计</h3>

<ul>
  <li>一个V(<code class="language-plaintext highlighter-rouge">ViewController</code>也是一个V)对应一个VM，V界面元素属性与 VM 处理后的数据属性绑定。</li>
  <li><code class="language-plaintext highlighter-rouge">ViewController</code>对应的VM算是主VM。主 VM 承担了网络请求、点击事件协议、初始化子 VM 并且给子VM的属性赋初值；网络请求成功返回数据过后，主 ViewModel 还需要给子 ViewModel 的属性赋予新的值。</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">mainViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">MineHeaderViewModel</span> <span class="o">*</span><span class="n">mineHeaderViewModel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">MineTopCollectionViewCellViewModel</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">dataSorceOfMineTopCollectionViewCell</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">MineDownCollectionViewCellViewModel</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">dataSorceOfMineDownCollectionViewCell</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">autoLoginCommand</span><span class="p">;</span><span class="c1">//用于网络请求</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">pushSubject</span><span class="p">;</span><span class="c1">//相当于协议，这里用于点击事件的代理</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="示例列表刷新">示例：列表刷新</h3>

<p>具体效果：</p>

<p><img src="/assets/images/iOS/rac/15.gif" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19</pre></td><td class="code"><pre class="highlight"><code>2020-06-03 14:20:34.431310+0800 RACExample[29796:2244630] refreshDataCommand execute
2020-06-03 14:20:34.464985+0800 RACExample[29796:2244630] executing subscribeNext
2020-06-03 14:20:34.465376+0800 RACExample[29796:2244630] RefreshLoading
2020-06-03 14:20:35.088477+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendNext
2020-06-03 14:20:35.088770+0800 RACExample[29796:2244630] switchToLatest subscribeNext
2020-06-03 14:20:35.092880+0800 RACExample[29796:2244630] RefreshUI
2020-06-03 14:20:35.093239+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendCompleted
2020-06-03 14:20:37.458024+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendNext
2020-06-03 14:20:37.458241+0800 RACExample[29796:2244630] switchToLatest subscribeNext
2020-06-03 14:20:37.458642+0800 RACExample[29796:2244630] RefreshUI
2020-06-03 14:20:37.458772+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendCompleted
2020-06-03 14:20:38.549670+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendNext
2020-06-03 14:20:38.549901+0800 RACExample[29796:2244630] switchToLatest subscribeNext
2020-06-03 14:20:38.550304+0800 RACExample[29796:2244630] RefreshUI
2020-06-03 14:20:38.550600+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendCompleted
2020-06-03 14:20:40.055668+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendNext
2020-06-03 14:20:40.055887+0800 RACExample[29796:2244630] switchToLatest subscribeNext
2020-06-03 14:20:40.056336+0800 RACExample[29796:2244630] RefreshUI
2020-06-03 14:20:40.056514+0800 RACExample[29796:2244630] refreshDataCommand subscriber sendCompleted
</code></pre></td></tr></tbody></table></div></div>

<p>他们的项目结构：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16</pre></td><td class="code"><pre class="highlight"><code>├── Controller
│   ├── CircleListViewController.h
│   └── CircleListViewController.m
├── Model
│   ├── DouBanTheatersModel.h
│   └── DouBanTheatersModel.m
├── View
│   ├── CircleListMainView.h
│   ├── CircleListMainView.m
│   ├── CircleListMainViewCell.h
│   └── CircleListMainViewCell.m
└── ViewModel
    ├── CircleListMainViewCellViewModel.h
    ├── CircleListMainViewCellViewModel.m
    ├── CircleListMainViewModel.h
    └── CircleListMainViewModel.m
</code></pre></td></tr></tbody></table></div></div>

<h4 id="circlelistviewcontroller">CircleListViewController</h4>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">CircleListViewController</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">CircleListMainView</span> <span class="o">*</span><span class="n">mainView</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">CircleListMainViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">CircleListViewController</span>
<span class="cp">#pragma mark - life cycle
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">mainView</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateViewConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">mainView</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">edges</span><span class="p">.</span><span class="n">mas_equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateViewConstraints</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="c1">// 点击 cell 跳转 Controller</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">cellClickSubject</span> <span class="nf">takeUntil</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">rac_willDeallocSignal</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">CircleListMainViewCellViewModel</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
        <span class="n">UIViewController</span> <span class="o">*</span><span class="n">VC</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIViewController</span> <span class="nf">new</span><span class="p">];</span>
        <span class="n">VC</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">whiteColor</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">navigationController</span> <span class="nf">pushViewController</span><span class="p">:</span><span class="n">VC</span> <span class="nf">animated</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span> <span class="p">(</span><span class="n">CircleListMainView</span> <span class="o">*</span><span class="p">)</span><span class="n">mainView</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_mainView</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_mainView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CircleListMainView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithViewModel</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_mainView</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="n">CircleListMainViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CircleListMainViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h4 id="viewmodel">ViewModel</h4>

<h5 id="circlelistmainviewmodel">CircleListMainViewModel</h5>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86<br/>87<br/>88<br/>89<br/>90<br/>91<br/>92<br/>93<br/>94<br/>95<br/>96<br/>97<br/>98<br/>99<br/>100<br/>101<br/>102<br/>103<br/>104<br/>105<br/>106<br/>107<br/>108<br/>109<br/>110<br/>111<br/>112<br/>113<br/>114<br/>115<br/>116<br/>117<br/>118<br/>119<br/>120</pre></td><td class="code"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">enum</span> <span class="o">:</span> <span class="n">NSUInteger</span> <span class="p">{</span>
    <span class="n">RefreshLoading</span><span class="p">,</span> <span class="c1">// 正在刷新</span>
    <span class="n">RefreshError</span><span class="p">,</span> <span class="c1">// 刷新出错</span>
    <span class="n">RefreshUI</span><span class="p">,</span> <span class="c1">// 仅仅刷新UI布局</span>
<span class="p">}</span> <span class="n">RefreshDataStatus</span><span class="p">;</span>

<span class="k">@interface</span> <span class="nc">CircleListMainViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">refreshDataCommand</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">refreshDataSubject</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACSubject</span> <span class="o">*</span><span class="n">cellClickSubject</span><span class="p">;</span><span class="c1">//点击cell的热信号</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">CircleListMainViewCellViewModel</span><span class="o">*&gt;</span> <span class="o">*</span><span class="n">dataArray</span><span class="p">;</span>
<span class="k">@end</span>

<span class="c1">// ============================.m==========================</span>
<span class="k">@interface</span> <span class="nc">CircleListMainViewModel</span><span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">HttpManager</span> <span class="o">*</span><span class="n">httpManager</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span><span class="n">readwrite</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">CircleListMainViewCellViewModel</span><span class="o">*&gt;</span> <span class="o">*</span><span class="n">dataArray</span><span class="p">;</span>
<span class="k">@end</span>

<span class="n">implementation</span> <span class="n">CircleListMainViewModel</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - business
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{</span>
    <span class="c1">// 初始化 RACCommand ，并发起网络请求。</span>
    <span class="n">_refreshDataCommand</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSignalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            
            <span class="c1">// 网络请求</span>
            <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="nf">dictionary</span><span class="p">];</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s">@"apikey"</span><span class="p">]</span> <span class="o">=</span> <span class="s">@"0df993c66c0c636e29ecbb5344252a4a"</span><span class="p">;</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">httpManager</span> <span class="nf">requestNetworkDataWithUrlString</span><span class="p">:</span><span class="s">@"/v2/movie/in_theaters"</span> <span class="nf">Params</span><span class="p">:</span><span class="n">parameters</span> <span class="n">completed</span><span class="o">:^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nonnull</span> <span class="n">response</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"refreshDataCommand subscriber sendError"</span><span class="p">);</span>
                    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendError</span><span class="p">:</span><span class="n">error</span><span class="p">];</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"refreshDataCommand subscriber sendNext"</span><span class="p">);</span>
                    <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">response</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"refreshDataCommand subscriber sendCompleted"</span><span class="p">);</span>
                <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
            <span class="p">}];</span>
            
            <span class="k">return</span> <span class="p">[</span><span class="n">RACDisposable</span> <span class="nf">disposableWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">}];</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    
    <span class="c1">// 信号流：O-O-O-O-O-O，而下面这段就是,跳过第一个信号，并且只执行一次。</span>
    <span class="p">[[[</span><span class="n">_refreshDataCommand</span><span class="p">.</span><span class="n">executing</span> <span class="nf">skip</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">take</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"executing subscribeNext"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">showStatus</span><span class="p">:</span><span class="s">@"正在加载..."</span><span class="p">];</span>
    <span class="p">}];</span>
    
    <span class="c1">// 进行业务处理</span>
    <span class="p">[[[</span><span class="n">_refreshDataCommand</span> <span class="nf">executionSignals</span><span class="p">]</span> <span class="nf">switchToLatest</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSDictionary</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"switchToLatest subscribeNext"</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">response</span><span class="p">)</span> <span class="p">{</span>
             <span class="p">[</span><span class="n">self</span> <span class="nf">showErrorStatus</span><span class="p">:</span><span class="s">@"网络有问题！"</span><span class="p">];</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// 把 BO 数据转成 VM</span>
        <span class="n">NSMutableArray</span><span class="o">&lt;</span><span class="n">CircleListMainViewCellViewModel</span><span class="o">*&gt;*</span><span class="n">tempt</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>
        <span class="n">NSArray</span> <span class="o">*</span><span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="n">response</span> <span class="nf">valueForKey</span><span class="p">:</span><span class="s">@"subjects"</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="n">object</span> <span class="k">in</span> <span class="n">subjects</span><span class="p">)</span> <span class="p">{;</span>
            <span class="n">CircleListMainViewCellViewModel</span> <span class="o">*</span><span class="n">cellViewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CircleListMainViewCellViewModel</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
            <span class="n">cellViewModel</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">DouBanTheatersModel</span> <span class="nf">yy_modelWithJSON</span><span class="p">:</span><span class="n">object</span><span class="p">];</span>
            <span class="p">[</span><span class="n">tempt</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">cellViewModel</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dataArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSArray</span> <span class="nf">arrayWithArray</span><span class="p">:</span><span class="n">tempt</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">showMessage</span><span class="p">:</span><span class="s">@"请求成功！"</span><span class="p">];</span>
    <span class="p">}];</span>
    
    <span class="c1">// 错误处理</span>
    <span class="p">[</span><span class="n">_refreshDataCommand</span><span class="p">.</span><span class="n">errors</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"errors subscribeNext"</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">showErrorStatus</span><span class="p">:</span><span class="s">@"网络有问题！"</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showMessage</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">message</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">refreshDataSubject</span> <span class="nf">sendNext</span><span class="p">:@{</span><span class="s">@"code"</span><span class="o">:</span><span class="err">@</span><span class="p">(</span><span class="n">RefreshUI</span><span class="p">),</span><span class="s">@"msg"</span><span class="o">:</span><span class="n">message</span><span class="p">}];</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showStatus</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">status</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">refreshDataSubject</span> <span class="nf">sendNext</span><span class="p">:@{</span><span class="s">@"code"</span><span class="o">:</span><span class="err">@</span><span class="p">(</span><span class="n">RefreshLoading</span><span class="p">),</span><span class="s">@"msg"</span><span class="o">:</span><span class="n">status</span><span class="p">}];</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showErrorStatus</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">error</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">refreshDataSubject</span> <span class="nf">sendNext</span><span class="p">:@{</span><span class="s">@"code"</span><span class="o">:</span><span class="err">@</span><span class="p">(</span><span class="n">RefreshError</span><span class="p">),</span><span class="s">@"msg"</span><span class="o">:</span><span class="n">error</span><span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">HttpManager</span> <span class="o">*</span><span class="p">)</span><span class="n">httpManager</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_httpManager</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_httpManager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">HttpManager</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithBaseURLString</span><span class="p">:</span><span class="s">@"https://api.douban.com"</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_httpManager</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="n">RACSubject</span> <span class="o">*</span><span class="p">)</span><span class="n">refreshDataSubject</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_refreshDataSubject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_refreshDataSubject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_refreshDataSubject</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">RACSubject</span> <span class="o">*</span><span class="p">)</span><span class="n">cellClickSubject</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_cellClickSubject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_cellClickSubject</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSubject</span> <span class="nf">subject</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_cellClickSubject</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h5 id="circlelistmainviewcellviewmodel">CircleListMainViewCellViewModel</h5>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">CircleListMainViewCellViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">DouBanTheatersModel</span> <span class="o">*</span><span class="n">model</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">CircleListMainViewCellViewModel</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - business
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{}</span>
<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">DouBanTheatersModel</span> <span class="o">*</span><span class="p">)</span><span class="n">model</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_model</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DouBanTheatersModel</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_model</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h4 id="view">View</h4>

<h5 id="circlelistmainview">CircleListMainView</h5>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86<br/>87<br/>88<br/>89<br/>90<br/>91<br/>92<br/>93<br/>94<br/>95<br/>96<br/>97<br/>98<br/>99<br/>100<br/>101<br/>102<br/>103<br/>104<br/>105<br/>106<br/>107<br/>108<br/>109<br/>110<br/>111<br/>112<br/>113<br/>114<br/>115<br/>116<br/>117<br/>118<br/>119<br/>120<br/>121<br/>122<br/>123<br/>124</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">CircleListMainView</span> <span class="p">:</span> <span class="nc">UIView</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">CircleListMainViewModel</span><span class="o">*</span> <span class="n">viewModel</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">CircleListMainViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="c1">// ==============================.m================================</span>

<span class="k">@interface</span> <span class="nc">CircleListMainView</span><span class="p">()</span><span class="o">&lt;</span><span class="n">UITableViewDataSource</span><span class="p">,</span> <span class="n">UITableViewDelegate</span><span class="o">&gt;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UITableView</span> <span class="o">*</span><span class="n">mainTableView</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">CircleListMainView</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithViewModel</span><span class="p">:(</span><span class="n">CircleListMainViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">superview</span><span class="p">.</span><span class="n">backgroundColor</span><span class="p">;</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="n">viewModel</span><span class="p">;</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setNeedsUpdateConstraints</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">updateConstraintsIfNeeded</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">mainTableView</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">mainTableView</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">edges</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateConstraints</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">setMinimumDismissTimeInterval</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">];</span>
    
    <span class="c1">// 数据请求</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"refreshDataCommand execute"</span><span class="p">);</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">refreshDataCommand</span> <span class="nf">execute</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="c1">// 数据刷新</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">refreshDataSubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSDictionary</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">mainTableView</span><span class="p">.</span><span class="n">mj_header</span> <span class="nf">endRefreshing</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">mainTableView</span><span class="p">.</span><span class="n">mj_footer</span> <span class="nf">endRefreshing</span><span class="p">];</span>
        
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">mainTableView</span> <span class="nf">reloadData</span><span class="p">];</span>
        
        <span class="n">NSInteger</span> <span class="n">code</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span> <span class="nf">valueForKey</span><span class="p">:</span><span class="s">@"code"</span><span class="p">]</span> <span class="nf">integerValue</span><span class="p">];</span>
        <span class="n">NSString</span><span class="o">*</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="nf">valueForKey</span><span class="p">:</span><span class="s">@"msg"</span><span class="p">];</span>
        
        <span class="k">switch</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">RefreshLoading</span><span class="p">:</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RefreshLoading"</span><span class="p">);</span>
                <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">show</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">RefreshError</span><span class="p">:</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RefreshError"</span><span class="p">);</span>
                <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">showErrorWithStatus</span><span class="p">:</span><span class="n">msg</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">RefreshUI</span><span class="p">:</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"RefreshUI"</span><span class="p">);</span>
                <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">showSuccessWithStatus</span><span class="p">:</span><span class="n">msg</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="nl">default:</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">CircleListMainViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CircleListMainViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">mainTableView</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_mainTableView</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_mainTableView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
        <span class="n">_mainTableView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
        <span class="n">_mainTableView</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
        <span class="n">_mainTableView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">backgroundColor</span><span class="p">;</span>
        <span class="n">_mainTableView</span><span class="p">.</span><span class="n">separatorStyle</span> <span class="o">=</span> <span class="n">UITableViewCellSeparatorStyleNone</span><span class="p">;</span>
        <span class="n">_mainTableView</span><span class="p">.</span><span class="n">mj_header</span> <span class="o">=</span> <span class="p">[</span><span class="n">MJRefreshNormalHeader</span> <span class="nf">headerWithRefreshingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">refreshDataCommand</span> <span class="nf">execute</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="n">_mainTableView</span><span class="p">.</span><span class="n">mj_footer</span> <span class="o">=</span> <span class="p">[</span><span class="n">MJRefreshAutoNormalFooter</span> <span class="nf">footerWithRefreshingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">refreshDataCommand</span> <span class="nf">execute</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">}];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_mainTableView</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - ====================delegate====================
</span>
<span class="cp">#pragma mark - UITableViewDataSource
</span><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">numberOfSectionsInTableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="n">CircleListMainViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">CircleListMainViewCell</span> <span class="nf">cellWithTableView</span><span class="p">:</span><span class="n">tableView</span> <span class="nf">indexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cell</span><span class="p">.</span><span class="n">viewModel</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - UITableViewDelegate
</span><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">cellClickSubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">]];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h5 id="circlelistmainviewcell">CircleListMainViewCell</h5>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">CircleListMainViewCell</span> <span class="p">:</span> <span class="nc">UITableViewCell</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSIndexPath</span> <span class="o">*</span><span class="n">indexPath</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">CircleListMainViewCellViewModel</span><span class="o">*</span> <span class="n">viewModel</span><span class="p">;</span>

<span class="k">+</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">reuseIdentifier</span><span class="p">;</span>
<span class="k">+</span><span class="p">(</span><span class="n">CircleListMainViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellWithTableView</span><span class="p">:(</span><span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">indexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">CircleListMainViewCell</span>
<span class="cp">#pragma mark - Init Views
</span><span class="k">+</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">reuseIdentifier</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">NSStringFromClass</span><span class="p">([</span><span class="n">self</span> <span class="nf">class</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">+</span><span class="p">(</span><span class="n">CircleListMainViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellWithTableView</span><span class="p">:(</span><span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">indexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
    <span class="n">CircleListMainViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nf">dequeueReusableCellWithIdentifier</span><span class="p">:[</span><span class="n">self</span> <span class="nf">reuseIdentifier</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cell</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CircleListMainViewCell</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithStyle</span><span class="p">:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nf">reuseIdentifier</span><span class="p">:[</span><span class="n">self</span> <span class="nf">reuseIdentifier</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">indexPath</span> <span class="o">=</span> <span class="n">indexPath</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithStyle</span><span class="p">:(</span><span class="n">UITableViewCellStyle</span><span class="p">)</span><span class="nv">style</span> <span class="nf">reuseIdentifier</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">reuseIdentifier</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithStyle</span><span class="p">:</span><span class="n">style</span> <span class="nf">reuseIdentifier</span><span class="p">:</span><span class="n">reuseIdentifier</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">updateConstraints</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateConstraints</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">title</span><span class="p">;</span>
    
    <span class="c1">//RAC(self.textLabel,text) = RACObserve(self.viewModel.model, title); ==&gt; 这个在数据刷新的时候报错！因为KVO的keypath重复绑定。</span>
    <span class="c1">//RAC(self.textLabel,text) = [RACObserve(self.viewModel.model, title) takeUntil:self.rac_prepareForReuseSignal]; ==&gt; 可以通过这样的方式搞定。</span>
    <span class="c1">//在cell里面创建的信号加上takeUntil:cell.rac_prepareForReuseSignal，这个是让cell在每次重用的时候都去disposable创建的信号。</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span>
<span class="cp">#pragma mark setter
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setViewModel</span><span class="p">:(</span><span class="n">CircleListMainViewCellViewModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">{</span>
    <span class="n">_viewModel</span> <span class="o">=</span> <span class="n">viewModel</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">viewModel</span><span class="p">)</span>  <span class="k">return</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="tableviewuibutton">TableView&amp;UIButton</h3>

<p>在<code class="language-plaintext highlighter-rouge">UITableViewCell</code>中有<code class="language-plaintext highlighter-rouge">UIButton</code>按钮，点击按钮出发回调，会有如下一种错误场景：<strong>刷新数据时，会重复订阅，导致方法多次触发</strong></p>

<p><img src="/assets/images/iOS/rac/16.gif" /></p>

<p><strong>CircleListMainView:</strong></p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="n">CircleListMainViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">CircleListMainViewCell</span> <span class="nf">cellWithTableView</span><span class="p">:</span><span class="n">tableView</span> <span class="nf">indexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cell</span><span class="p">.</span><span class="n">viewModel</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">cell</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">buttonClickSubject</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"raiseButton subscribeNext--%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><strong>CircleListMainViewCell:</strong></p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12</pre></td><td class="code"><pre class="highlight"><code><span class="k">@implementation</span> <span class="nc">CircleListMainViewCell</span>
<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
   <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
   <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">raiseButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
       <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
       <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">buttonClickSubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">model</span><span class="p">];</span>
   <span class="p">}];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p>在<code class="language-plaintext highlighter-rouge">UITableViewCell</code>的分类中，有一个属性<code class="language-plaintext highlighter-rouge">rac_prepareForReuseSignal</code>，可以解决这一问题。</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12</pre></td><td class="code"><pre class="highlight"><code><span class="k">@implementation</span> <span class="nc">CircleListMainViewCell</span>
<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="p">[[[</span><span class="n">self</span><span class="p">.</span><span class="n">raiseButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">takeUntil</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">rac_prepareForReuseSignal</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">buttonClickSubject</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">title</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/17.gif" /></p>

<h3 id="tableviewuitextfield">TableView&amp;UITextField</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACChannelTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span><span class="n">leftString</span><span class="p">)</span> <span class="o">=</span>  <span class="n">RACChannelTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">leftTextField</span><span class="p">,</span><span class="n">text</span><span class="p">);</span>
<span class="p">[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span><span class="n">leftString</span><span class="p">)</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"leftString %@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
<span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">clickButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">leftString</span> <span class="o">=</span> <span class="s">@"代码设置StringValue"</span><span class="p">;</span>
<span class="p">}];</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/18.gif" /></p>

<p>通过<code class="language-plaintext highlighter-rouge">RACChannelTo</code>对<code class="language-plaintext highlighter-rouge">TextField.txt</code>和<code class="language-plaintext highlighter-rouge">VM.leftString</code>进行双向绑定，可以发现，<code class="language-plaintext highlighter-rouge">TextField</code>进行键盘输入时，<code class="language-plaintext highlighter-rouge">VM.leftString</code>的值不会更新。当通过代码去对<code class="language-plaintext highlighter-rouge">VM.leftString</code>进行赋值时，<code class="language-plaintext highlighter-rouge">TextField.txt</code>的值更新了。而按照官方的说法就是，<code class="language-plaintext highlighter-rouge">UIKIt</code>里面的很多控件本身不支持<code class="language-plaintext highlighter-rouge">KVO</code>，而<code class="language-plaintext highlighter-rouge">ReactiveCocoa</code>本身是基于<code class="language-plaintext highlighter-rouge">KVO</code>实现的，所以就会出现这种双向绑定不成功的现象。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">self.valueTextField.rac_newTextChannel</code> : sends values when you type in the text field, but not when you change the text in the text field from code.</li>
  <li><code class="language-plaintext highlighter-rouge">RACChannelTo(self.valueTextField, text)</code> : sends values when you change the text in the text field from code, but not when you type in the text field.</li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code><span class="n">RACChannelTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span><span class="n">leftString</span><span class="p">)</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">leftTextField</span><span class="p">.</span><span class="n">rac_newTextChannel</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/19.gif" /></p>

<h4 id="tableviewcelluitextfield">TableViewCell&amp;UITextField</h4>

<p><img src="/assets/images/iOS/rac/20.gif" /></p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86<br/>87<br/>88<br/>89<br/>90<br/>91<br/>92<br/>93<br/>94</pre></td><td class="code"><pre class="highlight"><code><span class="cp">#pragma mark - ====================VM层====================
</span><span class="k">@interface</span> <span class="nc">TextFieldAndTableCellViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">leftString</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">rightString</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">TextFieldAndTableViewCellViewModel</span><span class="o">*&gt;</span> <span class="o">*</span><span class="n">dataArray</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">TextFieldAndTableCellViewModel</span>
<span class="k">-</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="n">dataArray</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_dataArray</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">tempt</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">NSInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">TextFieldAndTableViewCellViewModel</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">TextFieldAndTableViewCellViewModel</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
            <span class="n">data</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="p">[</span><span class="n">tempt</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">data</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">_dataArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSArray</span> <span class="nf">arrayWithArray</span><span class="p">:</span><span class="n">tempt</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_dataArray</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="cp">#pragma mark - ====================V层====================
</span>
<span class="k">@interface</span> <span class="nc">TextFieldAndTableCellViewController</span> <span class="p">()</span><span class="o">&lt;</span><span class="n">UITableViewDataSource</span><span class="p">,</span> <span class="n">UITableViewDelegate</span><span class="o">&gt;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITableView</span> <span class="o">*</span><span class="n">tableView</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">leftTextField</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">rightTextField</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span><span class="n">textLabel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">clickButton</span><span class="p">;</span>

<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">TextFieldAndTableCellViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">TextFieldAndTableCellViewController</span>
<span class="cp">#pragma mark - life cycle
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableView</span> <span class="nf">reloadData</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">tableView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">tableView</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateViewConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateViewConstraints</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">clickButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableView</span> <span class="nf">endEditing</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">TextFieldAndTableViewCellViewModel</span> <span class="o">*</span><span class="n">object</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"inputValue %@"</span><span class="p">,</span><span class="n">object</span><span class="p">.</span><span class="n">inputValue</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">TextFieldAndTableCellViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">TextFieldAndTableCellViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark setter
</span>
<span class="cp">#pragma mark - ====================delegate====================
</span>
<span class="cp">#pragma mark - UITableViewDataSource
</span><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">numberOfSectionsInTableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="n">TextFieldAndTableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">TextFieldAndTableViewCell</span> <span class="nf">cellWithTableView</span><span class="p">:</span><span class="n">tableView</span> <span class="nf">indexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">viewModel</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">dataArray</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - UITableViewDelegate
</span><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">50</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">TextFieldAndTableViewCell</span> <span class="p">:</span> <span class="nc">UITableViewCell</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">inputTextField</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSIndexPath</span> <span class="o">*</span><span class="n">indexPath</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">strong</span><span class="p">)</span> <span class="n">TextFieldAndTableViewCellViewModel</span><span class="o">*</span> <span class="n">viewModel</span><span class="p">;</span>

<span class="k">+</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">reuseIdentifier</span><span class="p">;</span>
<span class="k">+</span><span class="p">(</span><span class="n">TextFieldAndTableViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellWithTableView</span><span class="p">:(</span><span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">indexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">TextFieldAndTableViewCell</span>
<span class="cp">#pragma mark - Init Views
</span><span class="k">+</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">reuseIdentifier</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">NSStringFromClass</span><span class="p">([</span><span class="n">self</span> <span class="nf">class</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">+</span><span class="p">(</span><span class="n">TextFieldAndTableViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellWithTableView</span><span class="p">:(</span><span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">indexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
    <span class="n">TextFieldAndTableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nf">dequeueReusableCellWithIdentifier</span><span class="p">:[</span><span class="n">self</span> <span class="nf">reuseIdentifier</span><span class="p">]</span> <span class="nf">forIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cell</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">TextFieldAndTableViewCell</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithStyle</span><span class="p">:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nf">reuseIdentifier</span><span class="p">:[</span><span class="n">self</span> <span class="nf">reuseIdentifier</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">indexPath</span> <span class="o">=</span> <span class="n">indexPath</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithStyle</span><span class="p">:(</span><span class="n">UITableViewCellStyle</span><span class="p">)</span><span class="nv">style</span> <span class="nf">reuseIdentifier</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">reuseIdentifier</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithStyle</span><span class="p">:</span><span class="n">style</span> <span class="nf">reuseIdentifier</span><span class="p">:</span><span class="n">reuseIdentifier</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">updateConstraints</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">contentView</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">inputTextField</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Layout
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateConstraints</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">inputTextField</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">top</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">).</span><span class="n">mas_offset</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">).</span><span class="n">mas_offset</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">updateConstraints</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">inputTextField</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">inputValue</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">inputTextField</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">tag</span><span class="p">;</span>
    
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="p">[[[[</span><span class="n">self</span><span class="p">.</span><span class="n">inputTextField</span> <span class="nf">rac_textSignal</span><span class="p">]</span> <span class="nf">takeUntil</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">rac_prepareForReuseSignal</span><span class="p">]</span> <span class="nf">filter</span><span class="p">:</span><span class="o">^</span><span class="n">BOOL</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"filter -- %@"</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">}]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext %@ tag:%zd"</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">inputTextField</span><span class="p">.</span><span class="n">tag</span><span class="p">);</span>
        <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">inputValue</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span>
<span class="cp">#pragma mark setter
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setViewModel</span><span class="p">:(</span><span class="n">TextFieldAndTableViewCellViewModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewModel</span><span class="p">{</span>
    <span class="n">_viewModel</span> <span class="o">=</span> <span class="n">viewModel</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">viewModel</span><span class="p">)</span>  <span class="k">return</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">UITextField</span> <span class="o">*</span><span class="p">)</span><span class="n">inputTextField</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_inputTextField</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_inputTextField</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITextField</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
        <span class="n">_inputTextField</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIFont</span> <span class="nf">systemFontOfSize</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span>
        <span class="n">_inputTextField</span><span class="p">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">blackColor</span><span class="p">];</span>
        <span class="n">_inputTextField</span><span class="p">.</span><span class="n">tintColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">blackColor</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_inputTextField</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">TextFieldAndTableViewCellViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">inputValue</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">NSInteger</span> <span class="n">tag</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">TextFieldAndTableViewCellViewModel</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - business
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{</span>
<span class="p">}</span>
<span class="cp">#pragma mark - getter
</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="示例登录">示例：登录</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86<br/>87<br/>88<br/>89<br/>90<br/>91<br/>92<br/>93<br/>94<br/>95<br/>96<br/>97<br/>98<br/>99<br/>100<br/>101<br/>102<br/>103<br/>104<br/>105<br/>106<br/>107<br/>108<br/>109<br/>110<br/>111<br/>112<br/>113<br/>114<br/>115<br/>116<br/>117<br/>118<br/>119<br/>120<br/>121<br/>122<br/>123<br/>124<br/>125<br/>126<br/>127<br/>128<br/>129<br/>130<br/>131<br/>132<br/>133<br/>134<br/>135<br/>136<br/>137<br/>138<br/>139<br/>140<br/>141<br/>142<br/>143</pre></td><td class="code"><pre class="highlight"><code><span class="cm">/*================================================宏================================================*/</span>
<span class="cp">#define GreenBgColor [UIColor colorWithRed:0.8 green:1.0 blue:0.8 alpha:1]
#define RedBgColor   [UIColor colorWithRed:1.0 green:0.8 blue:0.8 alpha:1]
#define WhiteBgColor [UIColor whiteColor]
#define ConvertInputStateToColor(signal) [InputStateToColorConverter convert:signal]
#define ConvertTextToInputState(signal, minimum, maximum) [TextToInputStateConverter convert:signal m##inimum:minimum m##aximum:maximum]
</span><span class="k">typedef</span> <span class="k">enum</span> <span class="o">:</span> <span class="n">NSUInteger</span> <span class="p">{</span>
    <span class="n">InputStateEmpty</span><span class="p">,</span>
    <span class="n">InputStateValid</span><span class="p">,</span>
    <span class="n">InputStateInvalid</span>
<span class="p">}</span> <span class="n">InputState</span><span class="p">;</span>

<span class="cm">/*================================================V层-InputStateToColorConverter================================================*/</span>
<span class="k">@interface</span> <span class="nc">InputStateToColorConverter</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">convert</span><span class="p">:(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nv">signal</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">InputStateToColorConverter</span>
<span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">convert</span><span class="p">:(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nv">signal</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">signal</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span><span class="n">inputStateNumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">InputState</span> <span class="n">inputState</span> <span class="o">=</span> <span class="p">[</span><span class="n">inputStateNumber</span> <span class="nf">unsignedIntegerValue</span><span class="p">];</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">inputState</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">InputStateValid</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GreenBgColor</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">InputStateInvalid</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RedBgColor</span><span class="p">;</span>
            <span class="nl">default:</span>
                <span class="k">return</span> <span class="n">WhiteBgColor</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">@end</span>
<span class="cm">/*================================================V层-TextToInputStateConverter================================================*/</span>
<span class="k">@interface</span> <span class="nc">TextToInputStateConverter</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">convert</span><span class="p">:(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nv">signal</span> <span class="nf">minimum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">minimum</span> <span class="nf">maximum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">maximum</span><span class="p">;</span>
<span class="k">+</span> <span class="p">(</span><span class="n">InputState</span><span class="p">)</span><span class="nf">inputStateForText</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">text</span> <span class="nf">minimum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">minimum</span> <span class="nf">maximum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">maximum</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">TextToInputStateConverter</span>
<span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">convert</span><span class="p">:(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nv">signal</span> <span class="nf">minimum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">minimum</span> <span class="nf">maximum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">maximum</span><span class="p">{</span>
    <span class="n">NSAssert</span><span class="p">(</span><span class="n">minimum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">@"TextToInputStateConverter: minimum must be greater than zero"</span><span class="p">);</span>
    <span class="n">NSAssert</span><span class="p">(</span><span class="n">maximum</span> <span class="o">&gt;=</span> <span class="n">minimum</span><span class="p">,</span> <span class="s">@"TextToInputStateConverter: maximum must be greater than or equal to minimum"</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">signal</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="err">@</span><span class="p">([</span><span class="n">TextToInputStateConverter</span> <span class="nf">inputStateForText</span><span class="p">:</span><span class="n">text</span> <span class="nf">minimum</span><span class="p">:</span><span class="n">minimum</span> <span class="n">maximum</span><span class="o">:</span><span class="n">maximum</span><span class="p">]);</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="k">+</span> <span class="p">(</span><span class="n">InputState</span><span class="p">)</span><span class="nf">inputStateForText</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">text</span> <span class="nf">minimum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">minimum</span> <span class="nf">maximum</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">maximum</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">text</span> <span class="nf">length</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minimum</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">text</span> <span class="nf">length</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">maximum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">InputStateValid</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">text</span> <span class="nf">length</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">InputStateEmpty</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">InputStateInvalid</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">@end</span>
<span class="cp">#pragma mark - ====================VM层====================
</span><span class="k">@interface</span> <span class="nc">LoginViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">usename</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">InputState</span> <span class="n">usernameInputState</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">InputState</span> <span class="n">passwordInputState</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">loginEnabled</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">LoginViewModel</span><span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">readwrite</span><span class="p">)</span> <span class="n">InputState</span> <span class="n">usernameInputState</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">readwrite</span><span class="p">)</span> <span class="n">InputState</span> <span class="n">passwordInputState</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">readwrite</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">loginEnabled</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">LoginViewModel</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - business
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">usernameInputState</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvertTextToInputState</span><span class="p">(</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">usename</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">passwordInputState</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvertTextToInputState</span><span class="p">(</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">password</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">loginEnabled</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">combineLatest</span><span class="p">:@[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">usernameInputState</span><span class="p">),</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">passwordInputState</span><span class="p">)]</span> <span class="nf">reduce</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span><span class="n">usernameInputStateValue</span><span class="p">,</span><span class="n">NSNumber</span> <span class="o">*</span><span class="n">passwordInputStateValue</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">usernameInputStateValue</span> <span class="nf">unsignedIntegerValue</span><span class="p">]</span> <span class="o">==</span> <span class="n">InputStateValid</span> <span class="o">&amp;&amp;</span>
            <span class="p">[</span><span class="n">passwordInputStateValue</span> <span class="nf">unsignedIntegerValue</span><span class="p">]</span> <span class="o">==</span> <span class="n">InputStateValid</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="err">@</span><span class="p">(</span><span class="nb">YES</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="err">@</span><span class="p">(</span><span class="nb">NO</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>

<span class="cp">#pragma mark - ====================V层====================
</span><span class="k">@interface</span> <span class="nc">LoginViewController</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">usenameTextField</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">passwordTextFeidl</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">loginButton</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">LoginViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">LoginViewController</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="c1">// bind input signals</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span><span class="n">usename</span><span class="p">)</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">usenameTextField</span><span class="p">.</span><span class="n">rac_textSignal</span><span class="p">;</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span><span class="n">password</span><span class="p">)</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">passwordTextFeidl</span><span class="p">.</span><span class="n">rac_textSignal</span><span class="p">;</span>
    <span class="c1">// bind output signals</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">usenameTextField</span><span class="p">,</span><span class="n">backgroundColor</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvertInputStateToColor</span><span class="p">(</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span> <span class="n">usernameInputState</span><span class="p">));</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">passwordTextFeidl</span><span class="p">,</span><span class="n">backgroundColor</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvertInputStateToColor</span><span class="p">(</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span> <span class="n">passwordInputState</span><span class="p">));</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">loginButton</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span> <span class="o">=</span> <span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span> <span class="n">loginEnabled</span><span class="p">);</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">loginButton</span> <span class="nf">rac_signalForControlEvents</span><span class="p">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">__kindof</span> <span class="n">UIControl</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Login...."</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">LoginViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LoginViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/14.gif" /></p>

<h3 id="示例豆瓣列表">示例：豆瓣列表</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86<br/>87<br/>88<br/>89<br/>90<br/>91<br/>92<br/>93<br/>94<br/>95<br/>96<br/>97<br/>98<br/>99<br/>100<br/>101<br/>102<br/>103<br/>104<br/>105<br/>106<br/>107<br/>108<br/>109<br/>110<br/>111<br/>112<br/>113<br/>114<br/>115<br/>116<br/>117<br/>118<br/>119<br/>120<br/>121<br/>122<br/>123<br/>124<br/>125<br/>126<br/>127<br/>128<br/>129<br/>130<br/>131<br/>132<br/>133<br/>134<br/>135<br/>136<br/>137<br/>138<br/>139<br/>140<br/>141<br/>142<br/>143<br/>144<br/>145<br/>146<br/>147<br/>148<br/>149<br/>150</pre></td><td class="code"><pre class="highlight"><code><span class="cp">#pragma mark - ====================VM层====================
</span><span class="c1">//定义命令、网络请求、获取数据、发送数据</span>
<span class="k">@interface</span> <span class="nc">DouBanDetailViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">NSString</span><span class="o">*&gt;</span> <span class="o">*</span><span class="n">movies</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">requestCommand</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">AFHTTPSessionManager</span> <span class="o">*</span><span class="n">manager</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">DouBanDetailViewModel</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">_manager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFHTTPSessionManager</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithBaseURL</span><span class="p">:[</span><span class="n">NSURL</span> <span class="nf">URLWithString</span><span class="p">:</span><span class="s">@"https://api.douban.com"</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - business
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="n">_requestCommand</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSignalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 网络请求</span>
        <span class="n">RACSignal</span> <span class="o">*</span><span class="n">requestSignal</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">manager</span> <span class="nf">GET</span><span class="p">:</span><span class="s">@"/v2/movie/in_theaters"</span> <span class="nf">parameters</span><span class="p">:</span><span class="n">input</span> <span class="n">progress</span><span class="o">:</span><span class="nb">nil</span> <span class="n">success</span><span class="o">:^</span><span class="p">(</span><span class="n">NSURLSessionDataTask</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">task</span><span class="p">,</span> <span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendNext"</span><span class="p">);</span>
                <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="n">responseObject</span><span class="p">];</span>
                <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendCompleted</span><span class="p">];</span>
            <span class="p">}</span> <span class="n">failure</span><span class="o">:^</span><span class="p">(</span><span class="n">NSURLSessionDataTask</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">task</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendError</span><span class="p">:</span><span class="n">error</span><span class="p">];</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"sendError"</span><span class="p">);</span>
            <span class="p">}];</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">RACDisposable</span> <span class="nf">disposableWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"disposableWithBlock"</span><span class="p">);</span>
            <span class="p">}];</span>
        <span class="p">}];</span>
        <span class="c1">// 业务逻辑处理</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">requestSignal</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"map"</span><span class="p">);</span>
            <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">tempt</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>
            <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">dictArray</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s">@"subjects"</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="n">object</span> <span class="k">in</span> <span class="n">dictArray</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">tempt</span> <span class="nf">addObject</span><span class="p">:[</span><span class="n">object</span> <span class="nf">valueForKey</span><span class="p">:</span><span class="s">@"title"</span><span class="p">]];</span>
            <span class="p">}</span>
            <span class="n">self</span><span class="o">-&gt;</span><span class="n">_movies</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSArray</span> <span class="nf">arrayWithArray</span><span class="p">:</span><span class="n">tempt</span><span class="p">];;</span>
            <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cp">#pragma mark - getter
#pragma mark setter
</span><span class="k">@end</span>
<span class="cp">#pragma mark - ====================V层====================
</span>
<span class="k">@interface</span> <span class="nc">DouBanViewDetailController</span> <span class="p">()</span><span class="o">&lt;</span><span class="n">UITableViewDataSource</span><span class="p">,</span><span class="n">UITableViewDelegate</span><span class="o">&gt;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITableView</span> <span class="o">*</span><span class="n">tableView</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">DouBanDetailViewModel</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">DouBanViewDetailController</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">segInitViews</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Init Views
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">segInitViews</span><span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">tableView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">tableView</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="p">[[[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span> <span class="nf">executionSignals</span><span class="p">]</span> <span class="nf">switchToLatest</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"switchToLatest:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableView</span> <span class="nf">reloadData</span><span class="p">];</span>
        <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
    <span class="p">}];</span>

    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span><span class="p">.</span><span class="n">errors</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"errors subscribeNext:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
    <span class="p">}];</span>
    
    <span class="c1">// 发起网络请求</span>
    <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="nf">dictionary</span><span class="p">];</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s">@"apikey"</span><span class="p">]</span> <span class="o">=</span> <span class="s">@"0df993c66c0c636e29ecbb5344252a4a"</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span> <span class="nf">execute</span><span class="p">:</span><span class="n">parameters</span><span class="p">];</span>
    <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">show</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// 或者可以这样</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span> <span class="nf">executionSignals</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">RACSignal</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext1:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">show</span><span class="p">];</span>
        <span class="p">[</span><span class="n">x</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeNext2:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableView</span> <span class="nf">reloadData</span><span class="p">];</span>
            <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span><span class="p">.</span><span class="n">errors</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"errors subscribeNext:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
    <span class="p">}];</span>
    <span class="c1">// 发起网络请求</span>
    <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="nf">dictionary</span><span class="p">];</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s">@"apikey"</span><span class="p">]</span> <span class="o">=</span> <span class="s">@"0df993c66c0c636e29ecbb5344252a4a"</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span> <span class="nf">execute</span><span class="p">:</span><span class="n">parameters</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - UITableViewDataSource
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">numberOfSectionsInTableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span> <span class="p">{</span>
    
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">movies</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
    <span class="k">return</span> <span class="mi">44</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="n">DouBanDetailTableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">DouBanDetailTableViewCell</span> <span class="nf">cellWithTableView</span><span class="p">:</span><span class="n">tableView</span> <span class="nf">indexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">movies</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">DouBanDetailViewModel</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DouBanDetailViewModel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/13.gif" /></p>

<h3 id="raccommand中的senderror没反应的解答">RACCommand中的sendError没反应的解答</h3>

<ul>
  <li><a href="https://blog.harrisonxi.com/2017/09/RAC%E4%B8%AD%E7%94%A8RACCommand%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4.html">RAC中用RACCommand处理指令</a></li>
</ul>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4</pre></td><td class="code"><pre class="highlight"><code><span class="c1">// 这样使用就可以捕捉到Error了。</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span><span class="p">.</span><span class="n">errors</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">NSLog</span><span class="p">(</span><span class="s">@"errors subscribeNext:%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
<span class="p">}];</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="示例多接口请求">示例:多接口请求</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">DouBanDetailViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">requestCommand</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">DouBanDetailViewModel</span>
<span class="cp">#pragma mark - Init
</span><span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">racInit</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - business
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">racInit</span> <span class="p">{</span>
    <span class="n">_requestCommand</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSignalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//网络请求1</span>
        <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal1</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"网络请求1"</span><span class="p">);</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"网络请求1"</span><span class="p">];</span>
            <span class="k">return</span>  <span class="nb">nil</span><span class="p">;</span>
        <span class="p">}];</span>
        
        <span class="c1">//网络请求2</span>
        <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal2</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"网络请求2"</span><span class="p">);</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"网络请求2"</span><span class="p">];</span>
            <span class="k">return</span>  <span class="nb">nil</span><span class="p">;</span>
        <span class="p">}];</span>
        
        <span class="c1">//网络请求3</span>
        <span class="n">RACSignal</span> <span class="o">*</span><span class="n">signal3</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"网络请求3"</span><span class="p">);</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"网络请求3"</span><span class="p">];</span>
            <span class="k">return</span>  <span class="nb">nil</span><span class="p">;</span>
        <span class="p">}];</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">rac_liftSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nf">dealDataWithData1</span><span class="p">:</span><span class="n">data2</span><span class="o">:</span><span class="n">data3</span><span class="o">:</span><span class="p">)</span> <span class="n">withSignalsFromArray</span><span class="o">:</span><span class="p">@[</span><span class="n">signal1</span><span class="p">,</span><span class="n">signal2</span><span class="p">,</span><span class="n">signal3</span><span class="p">]];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dealDataWithData1</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">data1</span> <span class="nf">data2</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">data2</span> <span class="nf">data3</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">data3</span><span class="p">{}</span>
<span class="cp">#pragma mark - getter
#pragma mark setter
</span><span class="k">@end</span>
</code></pre></td></tr></tbody></table></div></div>

<p>V层使用：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="c1">// 发起网络请求</span>
    <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="nf">dictionary</span><span class="p">];</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s">@"q"</span><span class="p">]</span> <span class="o">=</span> <span class="n">_conditions</span><span class="p">;</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s">@"apikey"</span><span class="p">]</span> <span class="o">=</span> <span class="s">@"0df993c66c0c636e29ecbb5344252a4a"</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span> <span class="nf">execute</span><span class="p">:</span><span class="n">parameters</span><span class="p">];</span>
    <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">show</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span><span class="p">.</span><span class="n">executionSignals</span><span class="p">.</span><span class="n">switchToLatest</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableView</span> <span class="nf">reloadData</span><span class="p">];</span>
        <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span><span class="p">.</span><span class="n">executionSignals</span> <span class="nf">subscribeError</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">SVProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"subscribeError"</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[[[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">requestCommand</span> <span class="nf">executing</span><span class="p">]</span> <span class="nf">skip</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<h3 id="示例racdistinctuntilchanged">示例：RAC、distinctUntilChanged</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69</pre></td><td class="code"><pre class="highlight"><code><span class="cm">/*==================================VM层======================================*/</span> 
<span class="k">@interface</span> <span class="nc">RACAndMVVMViewModel01</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="c1">// KVO TextField输入值</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">searchText</span><span class="p">;</span>
<span class="c1">//创建一个绑定View的指令.RACCommand是ReactiveCocoa中呈现UI动作的组件.它包含一个来表示UI动作结果、当前状态、标明动作是否被执行的信号量.</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">executeSearch</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">RACAndMVVMViewModel01</span>
<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">checkSearchText</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// 这个方法中将执行一些业务逻辑作为执行命令的结果,并会通过信号异步地返回结果.</span>
<span class="c1">// 目前只完成了一个虚拟的执行情况;空信号立即完成.延迟操作增加了完成事件返回后的两秒延迟.用来使代码看起来更加真实.</span>
<span class="k">-</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="n">executeSearchSignal</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[[[[</span><span class="n">RACSignal</span> <span class="nf">empty</span><span class="p">]</span> <span class="nf">logAll</span><span class="p">]</span> <span class="nf">delay</span><span class="p">:</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span> <span class="nf">logAll</span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// 检查 searchText 输入的合法性</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">checkSearchText</span><span class="p">{</span>
    <span class="cm">/*[[RACObserve(self, searchText) map:^id _Nullable(NSString*  _Nullable value) {
     return @(value.length &gt; 3);
     }] subscribeNext:^(id  _Nullable x) {
     NSLog(@"search text is valid %@", x);
     }];*/</span>
    
    <span class="c1">// distinctUntilChanged 只有输入合法才能进行打印</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">validSearchSignal</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="err">@</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">);</span>
    <span class="p">}]</span><span class="nf">distinctUntilChanged</span><span class="p">];</span>
    <span class="p">[</span><span class="n">validSearchSignal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"search text is valid %@"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">executeSearch</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithEnabled</span><span class="p">:</span><span class="n">validSearchSignal</span> <span class="nf">signalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">executeSearchSignal</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="cm">/*
2020-05-29 15:57:23.746708+0800 RACExample[90175:12323634] search text is valid 0
2020-05-29 15:57:27.843193+0800 RACExample[90175:12323634] search text is valid 1
2020-05-29 15:57:34.804425+0800 RACExample[90175:12323634] search text is valid 0
*/</span>
<span class="k">@end</span>
<span class="cm">/*==================================V层======================================*/</span> 
<span class="k">@interface</span> <span class="nc">RACAndMVVMViewController01</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">loginButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">searchTextField</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">RACAndMVVMViewModel01</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">RACAndMVVMViewController01</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span><span class="n">searchText</span><span class="p">)</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">searchTextField</span><span class="p">.</span><span class="n">rac_textSignal</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">loginButton</span><span class="p">.</span><span class="n">rac_command</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">executeSearch</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">RACAndMVVMViewModel01</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACAndMVVMViewModel01</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/11.gif" /></p>

<p>当按钮值为<code class="language-plaintext highlighter-rouge">Input</code>时，按钮的状态是<code class="language-plaintext highlighter-rouge">Disabled</code>，因为输入的内容不合法。</p>

<h3 id="示例发邮件">示例：发邮件</h3>

<div class="language-objc highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73<br/>74<br/>75<br/>76<br/>77<br/>78<br/>79<br/>80<br/>81<br/>82<br/>83<br/>84<br/>85<br/>86<br/>87<br/>88<br/>89<br/>90<br/>91<br/>92<br/>93<br/>94<br/>95<br/>96<br/>97<br/>98<br/>99<br/>100<br/>101<br/>102<br/>103<br/>104<br/>105<br/>106<br/>107<br/>108<br/>109<br/>110<br/>111<br/>112<br/>113<br/>114<br/>115<br/>116<br/>117<br/>118<br/>119<br/>120<br/>121<br/>122<br/>123<br/>124</pre></td><td class="code"><pre class="highlight"><code><span class="cp">#pragma mark - ====================VM层====================
</span><span class="k">@interface</span> <span class="nc">RACAndMVVMViewModel02</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">statusMessage</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACCommand</span> <span class="o">*</span><span class="n">subscribeCommand</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">RACAndMVVMViewModel02</span>
<span class="k">-</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">rac_init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">rac_init</span><span class="p">{</span>
    <span class="err">@weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">emailSignal</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="err">@</span><span class="p">([</span><span class="n">self</span> <span class="nf">isValidEmail</span><span class="p">:</span><span class="n">value</span><span class="p">]);</span>
    <span class="p">}]</span><span class="nf">distinctUntilChanged</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">emailSignal</span> <span class="nf">subscribeNext</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}];</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">subscribeCommand</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithEnabled</span><span class="p">:</span><span class="n">emailSignal</span> <span class="nf">signalBlock</span><span class="p">:</span><span class="o">^</span><span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@strongify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">businessOperation</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">];</span>
    <span class="p">}];</span>
    
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">rac1</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">subscribeCommand</span><span class="p">.</span><span class="n">executionSignals</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Request"</span><span class="p">);</span>
        <span class="k">return</span> <span class="s">@"Request"</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">rac2</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">subscribeCommand</span><span class="p">.</span><span class="n">executionSignals</span> <span class="nf">flattenMap</span><span class="p">:</span><span class="o">^</span><span class="n">__kindof</span> <span class="n">RACSignal</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">RACSignal</span><span class="o">*</span> <span class="n">signal</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[[[</span><span class="n">signal</span> <span class="nf">materialize</span><span class="p">]</span><span class="nf">filter</span><span class="p">:</span><span class="o">^</span><span class="n">BOOL</span><span class="p">(</span><span class="n">RACEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"... RACEventType:%zd"</span><span class="p">,</span><span class="n">event</span><span class="p">.</span><span class="n">eventType</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">event</span><span class="p">.</span><span class="n">eventType</span> <span class="o">==</span> <span class="n">RACEventTypeCompleted</span><span class="p">;</span>
        <span class="p">}]</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span>  <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Thanks!"</span><span class="p">);</span>
            <span class="k">return</span> <span class="s">@"Thanks!"</span><span class="p">;</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="n">RACSignal</span> <span class="o">*</span><span class="n">rac3</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">subscribeCommand</span><span class="p">.</span><span class="n">errors</span> <span class="nf">subscribeOn</span><span class="p">:[</span><span class="n">RACScheduler</span> <span class="nf">mainThreadScheduler</span><span class="p">]]</span> <span class="nf">map</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error"</span><span class="p">);</span>
        <span class="k">return</span> <span class="s">@"Error"</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">statusMessage</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">merge</span><span class="p">:@[</span><span class="n">rac1</span><span class="p">,</span><span class="n">rac2</span><span class="p">,</span><span class="n">rac3</span><span class="p">]];</span>
<span class="p">}</span>

<span class="c1">// 处理业务逻辑</span>
<span class="k">-</span><span class="p">(</span><span class="n">RACSignal</span><span class="o">*</span><span class="p">)</span><span class="nf">businessOperation</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">content</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="nf">createSignal</span><span class="p">:</span><span class="o">^</span><span class="n">RACDisposable</span> <span class="o">*</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span>  <span class="n">_Nonnull</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Loading..."</span><span class="p">);</span>
        <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendNext</span><span class="p">:</span><span class="s">@"Loading..."</span><span class="p">];</span>
        <span class="n">dispatch_after</span><span class="p">(</span><span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)(</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">)),</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">subscriber</span> <span class="nf">sendError</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">RACDisposable</span> <span class="nf">disposableWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="c1">// 检测strin是否是邮件</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">isValidEmail</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">content</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">content</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
    
    <span class="n">NSString</span> <span class="o">*</span><span class="n">emailPattern</span> <span class="o">=</span>
    <span class="s">@"(?:[a-z0-9!#$%</span><span class="se">\</span><span class="s">&amp;'*+/=?</span><span class="se">\</span><span class="s">^_`{|}~-]+(?:</span><span class="se">\</span><span class="s">.[a-z0-9!#$%</span><span class="se">\</span><span class="s">&amp;'*+/=?</span><span class="se">\</span><span class="s">^_`{|}"</span>
    <span class="s">@"~-]+)*|</span><span class="se">\"</span><span class="s">(?:[</span><span class="se">\</span><span class="s">x01-</span><span class="se">\</span><span class="s">x08</span><span class="se">\</span><span class="s">x0b</span><span class="se">\</span><span class="s">x0c</span><span class="se">\</span><span class="s">x0e-</span><span class="se">\</span><span class="s">x1f</span><span class="se">\</span><span class="s">x21</span><span class="se">\</span><span class="s">x23-</span><span class="se">\</span><span class="s">x5b</span><span class="se">\</span><span class="s">x5d-</span><span class="se">\</span><span class="s">"</span>
    <span class="s">@"x7f]|</span><span class="se">\\</span><span class="s">[</span><span class="se">\</span><span class="s">x01-</span><span class="se">\</span><span class="s">x09</span><span class="se">\</span><span class="s">x0b</span><span class="se">\</span><span class="s">x0c</span><span class="se">\</span><span class="s">x0e-</span><span class="se">\</span><span class="s">x7f])*</span><span class="se">\"</span><span class="s">)@(?:(?:[a-z0-9](?:[a-"</span>
    <span class="s">@"z0-9-]*[a-z0-9])?</span><span class="se">\</span><span class="s">.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|</span><span class="se">\</span><span class="s">[(?:(?:25[0-5"</span>
    <span class="s">@"]|2[0-4][0-9]|[01]?[0-9][0-9]?)</span><span class="se">\</span><span class="s">.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-"</span>
    <span class="s">@"9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[</span><span class="se">\</span><span class="s">x01-</span><span class="se">\</span><span class="s">x08</span><span class="se">\</span><span class="s">x0b</span><span class="se">\</span><span class="s">x0c</span><span class="se">\</span><span class="s">x0e-</span><span class="se">\</span><span class="s">x1f</span><span class="se">\</span><span class="s">x21"</span>
    <span class="s">@"-</span><span class="se">\</span><span class="s">x5a</span><span class="se">\</span><span class="s">x53-</span><span class="se">\</span><span class="s">x7f]|</span><span class="se">\\</span><span class="s">[</span><span class="se">\</span><span class="s">x01-</span><span class="se">\</span><span class="s">x09</span><span class="se">\</span><span class="s">x0b</span><span class="se">\</span><span class="s">x0c</span><span class="se">\</span><span class="s">x0e-</span><span class="se">\</span><span class="s">x7f])+)</span><span class="se">\</span><span class="s">])"</span><span class="p">;</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="n">NSRegularExpression</span> <span class="o">*</span><span class="n">regex</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSRegularExpression</span> <span class="nf">regularExpressionWithPattern</span><span class="p">:</span><span class="n">emailPattern</span> <span class="nf">options</span><span class="p">:</span><span class="n">NSRegularExpressionCaseInsensitive</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
    <span class="n">NSTextCheckingResult</span> <span class="o">*</span><span class="n">match</span> <span class="o">=</span> <span class="p">[</span><span class="n">regex</span> <span class="nf">firstMatchInString</span><span class="p">:</span><span class="n">content</span> <span class="nf">options</span><span class="p">:</span><span class="mi">0</span> <span class="n">range</span><span class="o">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">content</span> <span class="nf">length</span><span class="p">])];</span>
    <span class="k">return</span> <span class="n">match</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
<span class="cp">#pragma mark - ====================V层====================
</span><span class="k">@interface</span> <span class="nc">RACAndMVVMViewController02</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">inputTextField</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">loginButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span><span class="n">statusLabel</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">RACAndMVVMViewModel02</span> <span class="o">*</span><span class="n">viewModel</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">RACAndMVVMViewController02</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindViewModel</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Private Methods
</span>
<span class="cp">#pragma mark - RAC Data Binding
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bindViewModel</span> <span class="p">{</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span><span class="n">email</span><span class="p">)</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">inputTextField</span><span class="p">.</span><span class="n">rac_textSignal</span><span class="p">;</span>
    <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">statusLabel</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="o">=</span> <span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">,</span> <span class="n">statusMessage</span><span class="p">);</span>
    <span class="n">self</span><span class="p">.</span><span class="n">loginButton</span><span class="p">.</span><span class="n">rac_command</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">subscribeCommand</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark - getter
</span><span class="k">-</span><span class="p">(</span><span class="n">RACAndMVVMViewModel02</span> <span class="o">*</span><span class="p">)</span><span class="n">viewModel</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_viewModel</span> <span class="o">=</span> <span class="p">[</span><span class="n">RACAndMVVMViewModel02</span> <span class="nf">new</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_viewModel</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark setter
</span><span class="k">@end</span>

<span class="cm">/*
2020-05-29 16:58:36.155235+0800 RACExample[92708:12365862] 0
2020-05-29 16:58:40.675972+0800 RACExample[92708:12365862] 1
2020-05-29 16:58:43.872743+0800 RACExample[92708:12365862] Request
2020-05-29 16:58:43.873233+0800 RACExample[92708:12365862] Loading...
2020-05-29 16:58:43.873464+0800 RACExample[92708:12365862] ... RACEventType:2 --&gt; 0 = RACEventTypeNext
2020-05-29 16:58:45.874203+0800 RACExample[92708:12365862] ... RACEventType:0 --&gt; 0 = RACEventTypeCompleted
2020-05-29 16:58:45.874431+0800 RACExample[92708:12365862] Thanks!
2020-05-29 16:58:45.876062+0800 RACExample[92708:12365862] Error
*/</span> 
</code></pre></td></tr></tbody></table></div></div>

<p><img src="/assets/images/iOS/rac/12.gif" /></p>

<!-- 










 -->
<!--====================================================================================================-->
<!-- 










 -->

<h2 id="资料">资料</h2>

<ul>
  <li><a href="https://github.com/ReactiveCocoa/ReactiveCocoa">Github-ReactiveCocoa</a></li>
  <li><a href="https://www.tuicool.com/articles/BBNRRf">响应式编程（Reactive Programming）介绍</a></li>
  <li><a href="https://link.jianshu.com/?t=http://www.raywenderlich.com/?p=62699">UITextField-RAC使用详解</a></li>
  <li><a href="https://blog.harrisonxi.com/2017/07/iOS%E4%BD%BF%E7%94%A8RAC%E5%AE%9E%E7%8E%B0MVVM%E7%9A%84%E6%AD%A3%E7%BB%8F%E5%A7%BF%E5%8A%BF.html">iOS使用RAC实现MVVM的正经姿势</a></li>
  <li><a href="https://draveness.me/raccommand/">优雅的 RACCommand</a></li>
</ul>

<p>http://timmy6.github.io/2019/02/27/MVVM/</p>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/assets/images/251576903498_.pic_hd.jpg" alt="Sam Lau WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/assets/images/261576903527_.pic_hd.jpg" alt="Sam Lau Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
      
      
      
      

      
      
        <div class="post-nav" id="post-nav-id">
          <div class="post-nav-next post-nav-item">
            
              <a href="/diary/2020/05/29/diary-omnigraffle/" rel="next" title="Omnigraffle 使用记录">
                <i class="fa fa-chevron-left"></i> Omnigraffle 使用记录
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/diary/2020/05/25/diary-tree/" rel="prev" title="Tree命令使用记录">
                Tree命令使用记录 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        







      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/assets/images/avatar.png"
               alt="Sam Lau" />
          <p class="site-author-name" itemprop="name">Sam Lau</p>
           
              <p class="site-description motion-element" itemprop="description">get busy living or get busy dying</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        
        
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            








            
              <div class="post-toc-content">
    <ol class=nav>
      <li class="nav-item nav-level-2"> <a class="nav-link" href="#基础"> <span class="nav-number">1</span> <span class="nav-text">基础</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#racsignal-触发流程"> <span class="nav-number">1.1</span> <span class="nav-text">RACSignal 触发流程</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#racsubjectracreplaysubject"> <span class="nav-number">1.2</span> <span class="nav-text">RACSubject、RACReplaySubject</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#冷信号与热信号"> <span class="nav-number">2</span> <span class="nav-text">冷信号与热信号</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#热信号"> <span class="nav-number">2.1</span> <span class="nav-text">热信号</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#冷信号"> <span class="nav-number">2.2</span> <span class="nav-text">冷信号</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#冷信号热信号比较"> <span class="nav-number">2.3</span> <span class="nav-text">冷信号、热信号比较</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#基础使用"> <span class="nav-number">3</span> <span class="nav-text">基础使用</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#racmulticastconnection"> <span class="nav-number">3.1</span> <span class="nav-text">RACMulticastConnection</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#线程操作"> <span class="nav-number">3.2</span> <span class="nav-text">线程操作</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号节流throttle"> <span class="nav-number">3.3</span> <span class="nav-text">信号节流:throttle</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号错误重试retry"> <span class="nav-number">3.4</span> <span class="nav-text">信号错误重试:retry</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#获取信号中的信号-switchtolatest"> <span class="nav-number">3.5</span> <span class="nav-text">获取信号中的信号: switchToLatest</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号发送顺序donextdocompleted"> <span class="nav-number">3.6</span> <span class="nav-text">信号发送顺序:doNext、doCompleted</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号取值taketakeuntiltakelast"> <span class="nav-number">3.7</span> <span class="nav-text">信号取值:take、takeUntil、takeLast</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#mapflattenmap拦截信号处理数据"> <span class="nav-number">3.8</span> <span class="nav-text">map、flattenMap(拦截信号处理数据)</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#示例"> <span class="nav-number">3.8.1</span> <span class="nav-text">示例</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#示例-1"> <span class="nav-number">3.8.2</span> <span class="nav-text">示例</span> </a> </li> </ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号操作时间delay延迟"> <span class="nav-number">3.9</span> <span class="nav-text">信号操作时间:delay(延迟)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号操作时间interval定时"> <span class="nav-number">3.10</span> <span class="nav-text">信号操作时间:interval(定时)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号操作时间timeout超时"> <span class="nav-number">3.11</span> <span class="nav-text">信号操作时间:timeout(超时)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号过滤distinctuntilchanged"> <span class="nav-number">3.12</span> <span class="nav-text">信号过滤:distinctUntilChanged</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号过滤ignore忽略"> <span class="nav-number">3.13</span> <span class="nav-text">信号过滤:ignore(忽略)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号过滤filter过滤"> <span class="nav-number">3.14</span> <span class="nav-text">信号过滤:filter(过滤)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号合并combinelatest结合reduce聚合"> <span class="nav-number">3.15</span> <span class="nav-text">信号合并:combineLatest(结合)、reduce(聚合)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号合并zipwith压缩"> <span class="nav-number">3.16</span> <span class="nav-text">信号合并:zipWith(压缩)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号合并merge合并"> <span class="nav-number">3.17</span> <span class="nav-text">信号合并:merge(合并)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号拼接then连接"> <span class="nav-number">3.18</span> <span class="nav-text">信号拼接:then(连接)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#信号拼接concat合并"> <span class="nav-number">3.19</span> <span class="nav-text">信号拼接:concat(合并)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#racobserve"> <span class="nav-number">3.20</span> <span class="nav-text">RACObserve</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#其他使用"> <span class="nav-number">3.21</span> <span class="nav-text">其他使用</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#raccommand"> <span class="nav-number">4</span> <span class="nav-text">RACCommand</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#使用"> <span class="nav-number">4.1</span> <span class="nav-text">使用</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#racchannel"> <span class="nav-number">5</span> <span class="nav-text">RACChannel</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#racchannel实现双向绑定"> <span class="nav-number">5.1</span> <span class="nav-text">RACChannel实现双向绑定</a</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#foundation"> <span class="nav-number">6</span> <span class="nav-text">Foundation</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#nsobject"> <span class="nav-number">6.1</span> <span class="nav-text">NSObject</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#nsobjectraclifting"> <span class="nav-number">6.1.1</span> <span class="nav-text">NSObject+RACLifting</span> </a> </li> </ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#nsnotificationcenter"> <span class="nav-number">6.2</span> <span class="nav-text">NSNotificationCenter</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#nsstring"> <span class="nav-number">6.3</span> <span class="nav-text">NSString</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#uikit"> <span class="nav-number">7</span> <span class="nav-text">UIKit</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#uicontrolracsignalsupportprivate"> <span class="nav-number">7.1</span> <span class="nav-text">UIControl+RACSignalSupportPrivate</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#uitextfieldracsignalsupport"> <span class="nav-number">7.2</span> <span class="nav-text">UITextField+RACSignalSupport</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#信号相关类"> <span class="nav-number">8</span> <span class="nav-text">信号相关类</span> </a> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#rac_deallocdisposablerac_deallocdisposablerac_prepareforreusesignal"> <span class="nav-number">9</span> <span class="nav-text">rac_deallocDisposable、rac_deallocDisposable、rac_prepareForReuseSignal</span> </a> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#tips"> <span class="nav-number">10</span> <span class="nav-text">Tips</span> </a> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#racmvvm开发规约"> <span class="nav-number">11</span> <span class="nav-text">RAC&amp;MVVM开发规约</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#vm层"> <span class="nav-number">11.1</span> <span class="nav-text">VM层</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#v层"> <span class="nav-number">11.2</span> <span class="nav-text">V层</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#controller"> <span class="nav-number">11.2.1</span> <span class="nav-text">Controller</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#自定义uiview"> <span class="nav-number">11.2.2</span> <span class="nav-text">自定义UIView</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#自定义复用机制uiview"> <span class="nav-number">11.2.3</span> <span class="nav-text">自定义复用机制UIView</span> </a> </li> </ol> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#mvvmrac"> <span class="nav-number">12</span> <span class="nav-text">MVVM&amp;RAC</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#使用设计"> <span class="nav-number">12.1</span> <span class="nav-text">使用设计</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#示例列表刷新"> <span class="nav-number">12.2</span> <span class="nav-text">示例：列表刷新</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#circlelistviewcontroller"> <span class="nav-number">12.2.1</span> <span class="nav-text">CircleListViewController</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#viewmodel"> <span class="nav-number">12.2.2</span> <span class="nav-text">ViewModel</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-5"> <a class="nav-link" href="#circlelistmainviewmodel"> <span class="nav-number">12.2.2.1</span> <span class="nav-text">CircleListMainViewModel</span> </a> </li> <li class="nav-item nav-level-5"> <a class="nav-link" href="#circlelistmainviewcellviewmodel"> <span class="nav-number">12.2.2.2</span> <span class="nav-text">CircleListMainViewCellViewModel</span> </a> </li> </ol> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#view"> <span class="nav-number">12.2.3</span> <span class="nav-text">View</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-5"> <a class="nav-link" href="#circlelistmainview"> <span class="nav-number">12.2.3.1</span> <span class="nav-text">CircleListMainView</span> </a> </li> <li class="nav-item nav-level-5"> <a class="nav-link" href="#circlelistmainviewcell"> <span class="nav-number">12.2.3.2</span> <span class="nav-text">CircleListMainViewCell</span> </a> </li> </ol> </li> </ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#tableviewuibutton"> <span class="nav-number">12.3</span> <span class="nav-text">TableView&amp;UIButton</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#tableviewuitextfield"> <span class="nav-number">12.4</span> <span class="nav-text">TableView&amp;UITextField</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#tableviewcelluitextfield"> <span class="nav-number">12.4.1</span> <span class="nav-text">TableViewCell&amp;UITextField</span> </a> </li> </ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#示例登录"> <span class="nav-number">12.5</span> <span class="nav-text">示例：登录</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#示例豆瓣列表"> <span class="nav-number">12.6</span> <span class="nav-text">示例：豆瓣列表</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#raccommand中的senderror没反应的解答"> <span class="nav-number">12.7</span> <span class="nav-text">RACCommand中的sendError没反应的解答</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#示例多接口请求"> <span class="nav-number">12.8</span> <span class="nav-text">示例:多接口请求</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#示例racdistinctuntilchanged"> <span class="nav-number">12.9</span> <span class="nav-text">示例：RAC、distinctUntilChanged</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#示例发邮件"> <span class="nav-number">12.10</span> <span class="nav-text">示例：发邮件</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#资料"> <span class="nav-number">13</span> <span class="nav-text">资料</span> </a> </li>
    </ol>
  </div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sam Lau</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  

  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  











  




  

    

  







  


  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>

